{
    "openapi": "3.0.0",
    "info": {
        "description": "Book digitization pipeline API for managing books, jobs, and processing.",
        "title": "Shelf API",
        "contact": {
            "name": "API Support",
            "url": "https://github.com/jackzampolin/shelf"
        },
        "license": {
            "name": "MIT",
            "url": "https://opensource.org/licenses/MIT"
        },
        "version": "1.0"
    },
    "paths": {
        "/api/books": {
            "get": {
                "description": "List all books in the library",
                "tags": [
                    "books"
                ],
                "summary": "List books",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ListBooksResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/ingest": {
            "post": {
                "description": "Ingest PDF files as a new book and start processing",
                "tags": [
                    "books"
                ],
                "summary": "Ingest book scans",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/internal_server_endpoints.IngestRequest"
                            }
                        }
                    },
                    "description": "Ingest request",
                    "required": true
                },
                "responses": {
                    "202": {
                        "description": "Accepted",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.IngestResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/ingest/upload": {
            "post": {
                "description": "Upload PDF files to ingest as a new book",
                "tags": [
                    "books"
                ],
                "summary": "Upload and ingest book PDFs",
                "requestBody": {
                    "content": {
                        "multipart/form-data": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "files": {
                                        "description": "PDF files to ingest",
                                        "type": "string",
                                        "format": "binary"
                                    },
                                    "title": {
                                        "description": "Book title (derived from filename if not provided)",
                                        "type": "string"
                                    },
                                    "author": {
                                        "description": "Book author",
                                        "type": "string"
                                    }
                                },
                                "required": [
                                    "files"
                                ]
                            }
                        }
                    },
                    "required": true
                },
                "responses": {
                    "202": {
                        "description": "Accepted",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.IngestResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/pages": {
            "get": {
                "description": "List all pages for a book with processing status",
                "tags": [
                    "pages"
                ],
                "summary": "List pages",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ListPagesResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/pages/{page_num}": {
            "get": {
                "description": "Get full details for a specific page including OCR results, blend output, and labels",
                "tags": [
                    "pages"
                ],
                "summary": "Get page details",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Page number (1-indexed)",
                        "name": "page_num",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.GetPageResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/pages/{page_num}/image": {
            "get": {
                "description": "Get the PNG image for a specific page of a book",
                "tags": [
                    "pages"
                ],
                "summary": "Get page image",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Page number (1-indexed)",
                        "name": "page_num",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "image/png": {
                                "schema": {
                                    "type": "string",
                                    "format": "binary"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "image/png": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "image/png": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "image/png": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{id}": {
            "get": {
                "description": "Get detailed information about a book",
                "tags": [
                    "books"
                ],
                "summary": "Get book by ID",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.Book"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{id}/cost": {
            "get": {
                "description": "Get total cost for processing a specific book",
                "tags": [
                    "books"
                ],
                "summary": "Get book processing cost",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Breakdown by: stage",
                        "name": "by",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.MetricsCostResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs": {
            "get": {
                "description": "List all jobs with optional filtering",
                "tags": [
                    "jobs"
                ],
                "summary": "List jobs",
                "parameters": [
                    {
                        "description": "Filter by status",
                        "name": "status",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by job type",
                        "name": "job_type",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ListJobsResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "post": {
                "description": "Create a new job of the specified type",
                "tags": [
                    "jobs"
                ],
                "summary": "Create a job",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/internal_server_endpoints.CreateJobRequest"
                            }
                        }
                    },
                    "description": "Job creation request",
                    "required": true
                },
                "responses": {
                    "201": {
                        "description": "Created",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.CreateJobResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs/start/{book_id}": {
            "post": {
                "description": "Start processing job (OCR, blend, label) for a book",
                "tags": [
                    "jobs"
                ],
                "summary": "Start job for a book",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/internal_server_endpoints.StartJobRequest"
                            }
                        }
                    },
                    "description": "Optional job type"
                },
                "responses": {
                    "202": {
                        "description": "Accepted",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.StartJobResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs/status/{book_id}": {
            "get": {
                "description": "Get processing status for a book's jobs",
                "tags": [
                    "jobs"
                ],
                "summary": "Get job status for a book",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Job type (default: process-pages)",
                        "name": "job_type",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.JobStatusResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs/{id}": {
            "get": {
                "description": "Get detailed job information including live status for running jobs",
                "tags": [
                    "jobs"
                ],
                "summary": "Get job by ID",
                "parameters": [
                    {
                        "description": "Job ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.GetJobResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "delete": {
                "description": "Delete a job by ID",
                "tags": [
                    "jobs"
                ],
                "summary": "Delete a job",
                "parameters": [
                    {
                        "description": "Job ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "204": {
                        "description": "No Content"
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "*/*": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "*/*": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "*/*": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "*/*": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "patch": {
                "description": "Update job status or metadata",
                "tags": [
                    "jobs"
                ],
                "summary": "Update a job",
                "parameters": [
                    {
                        "description": "Job ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/internal_server_endpoints.UpdateJobRequest"
                            }
                        }
                    },
                    "description": "Update request",
                    "required": true
                },
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.Record"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/metrics": {
            "get": {
                "description": "List LLM/OCR call metrics with optional filtering",
                "tags": [
                    "metrics"
                ],
                "summary": "List metrics",
                "parameters": [
                    {
                        "description": "Filter by job ID",
                        "name": "job_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by book ID",
                        "name": "book_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by stage",
                        "name": "stage",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by provider",
                        "name": "provider",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by model",
                        "name": "model",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Maximum results (default 100)",
                        "name": "limit",
                        "in": "query",
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ListMetricsResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/metrics/cost": {
            "get": {
                "description": "Get total cost with optional breakdown by stage/provider/model",
                "tags": [
                    "metrics"
                ],
                "summary": "Get cost breakdown",
                "parameters": [
                    {
                        "description": "Filter by job ID",
                        "name": "job_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by book ID",
                        "name": "book_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by stage",
                        "name": "stage",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by provider",
                        "name": "provider",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by model",
                        "name": "model",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Breakdown by: stage, provider, or model",
                        "name": "by",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.MetricsCostResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/metrics/summary": {
            "get": {
                "description": "Get aggregated metrics summary with counts, costs, and timing",
                "tags": [
                    "metrics"
                ],
                "summary": "Get metrics summary",
                "parameters": [
                    {
                        "description": "Filter by job ID",
                        "name": "job_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by book ID",
                        "name": "book_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by stage",
                        "name": "stage",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by provider",
                        "name": "provider",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by model",
                        "name": "model",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.MetricsSummaryResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/health": {
            "get": {
                "description": "Basic health check endpoint",
                "tags": [
                    "health"
                ],
                "summary": "Health check",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.HealthResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/ready": {
            "get": {
                "description": "Readiness check including DefraDB status",
                "tags": [
                    "health"
                ],
                "summary": "Readiness check",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.HealthResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.HealthResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/status": {
            "get": {
                "description": "Get detailed server status including providers and DefraDB",
                "tags": [
                    "health"
                ],
                "summary": "Server status",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.StatusResponse"
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "servers": [
        {
            "url": "//localhost:8080"
        }
    ],
    "components": {
        "schemas": {
            "github_com_jackzampolin_shelf_internal_jobs.ProviderProgress": {
                "type": "object",
                "properties": {
                    "completed": {
                        "description": "Completed during this job execution",
                        "type": "integer"
                    },
                    "completedAtStart": {
                        "description": "Already completed before job started (from DefraDB)",
                        "type": "integer"
                    },
                    "failed": {
                        "description": "Failed during this job execution",
                        "type": "integer"
                    },
                    "queued": {
                        "description": "Currently queued/in-flight",
                        "type": "integer"
                    },
                    "totalExpected": {
                        "description": "Total work units expected for this provider",
                        "type": "integer"
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_jobs.Record": {
                "type": "object",
                "properties": {
                    "_docID": {
                        "type": "string"
                    },
                    "completed_at": {
                        "type": "string"
                    },
                    "created_at": {
                        "type": "string"
                    },
                    "error": {
                        "type": "string"
                    },
                    "job_type": {
                        "type": "string"
                    },
                    "metadata": {
                        "type": "object",
                        "additionalProperties": {}
                    },
                    "started_at": {
                        "type": "string"
                    },
                    "status": {
                        "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.Status"
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_jobs.Status": {
                "type": "string",
                "enum": [
                    "queued",
                    "running",
                    "completed",
                    "failed",
                    "cancelled"
                ],
                "x-enum-varnames": [
                    "StatusQueued",
                    "StatusRunning",
                    "StatusCompleted",
                    "StatusFailed",
                    "StatusCancelled"
                ]
            },
            "github_com_jackzampolin_shelf_internal_jobs.WorkerStatusInfo": {
                "type": "object",
                "properties": {
                    "queue_depth": {
                        "type": "integer"
                    },
                    "rate_limiter": {
                        "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_providers.RateLimiterStatus"
                    },
                    "type": {
                        "type": "string"
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_metrics.Metric": {
                "type": "object",
                "properties": {
                    "_docID": {
                        "type": "string"
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "completion_tokens": {
                        "type": "integer"
                    },
                    "cost_usd": {
                        "description": "Cost and tokens",
                        "type": "number"
                    },
                    "created_at": {
                        "description": "Metadata",
                        "type": "string"
                    },
                    "error_type": {
                        "type": "string"
                    },
                    "execution_seconds": {
                        "type": "number"
                    },
                    "item_key": {
                        "description": "e.g., \"page_0001\", \"toc_entry_5\"",
                        "type": "string"
                    },
                    "job_id": {
                        "description": "Attribution (for filtering/aggregation)",
                        "type": "string"
                    },
                    "model": {
                        "type": "string"
                    },
                    "output_cid": {
                        "description": "Exact version (CID)",
                        "type": "string"
                    },
                    "output_doc_id": {
                        "description": "Output reference (version-specific)",
                        "type": "string"
                    },
                    "output_type": {
                        "description": "Collection name",
                        "type": "string"
                    },
                    "prompt_tokens": {
                        "type": "integer"
                    },
                    "provider": {
                        "description": "Provider info",
                        "type": "string"
                    },
                    "queue_seconds": {
                        "description": "Timing",
                        "type": "number"
                    },
                    "reasoning_tokens": {
                        "type": "integer"
                    },
                    "stage": {
                        "type": "string"
                    },
                    "success": {
                        "description": "Status",
                        "type": "boolean"
                    },
                    "total_seconds": {
                        "type": "number"
                    },
                    "total_tokens": {
                        "type": "integer"
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_providers.RateLimiterStatus": {
                "type": "object",
                "properties": {
                    "last_429_time": {
                        "type": "string"
                    },
                    "rps": {
                        "type": "number"
                    },
                    "time_until_token": {
                        "$ref": "#/components/schemas/time.Duration"
                    },
                    "tokens_available": {
                        "type": "number"
                    },
                    "total_consumed": {
                        "type": "integer"
                    },
                    "total_waited": {
                        "$ref": "#/components/schemas/time.Duration"
                    },
                    "utilization": {
                        "type": "number"
                    }
                }
            },
            "internal_server_endpoints.Book": {
                "type": "object",
                "properties": {
                    "author": {
                        "type": "string"
                    },
                    "created_at": {
                        "type": "string"
                    },
                    "id": {
                        "type": "string"
                    },
                    "page_count": {
                        "type": "integer"
                    },
                    "status": {
                        "type": "string"
                    },
                    "title": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.CreateJobRequest": {
                "type": "object",
                "properties": {
                    "job_type": {
                        "type": "string"
                    },
                    "metadata": {
                        "type": "object",
                        "additionalProperties": {}
                    }
                }
            },
            "internal_server_endpoints.CreateJobResponse": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.DefraStatus": {
                "type": "object",
                "properties": {
                    "container": {
                        "type": "string"
                    },
                    "health": {
                        "type": "string"
                    },
                    "url": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.ErrorResponse": {
                "type": "object",
                "properties": {
                    "error": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.GetJobResponse": {
                "type": "object",
                "properties": {
                    "_docID": {
                        "type": "string"
                    },
                    "completed_at": {
                        "type": "string"
                    },
                    "created_at": {
                        "type": "string"
                    },
                    "error": {
                        "type": "string"
                    },
                    "job_type": {
                        "type": "string"
                    },
                    "live_status": {
                        "description": "Live status fields (only populated for running jobs)",
                        "type": "object",
                        "additionalProperties": {
                            "type": "string"
                        }
                    },
                    "metadata": {
                        "type": "object",
                        "additionalProperties": {}
                    },
                    "pending_units": {
                        "type": "integer"
                    },
                    "progress": {
                        "type": "object",
                        "additionalProperties": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.ProviderProgress"
                        }
                    },
                    "started_at": {
                        "type": "string"
                    },
                    "status": {
                        "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.Status"
                    },
                    "worker_status": {
                        "type": "object",
                        "additionalProperties": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.WorkerStatusInfo"
                        }
                    }
                }
            },
            "internal_server_endpoints.GetPageResponse": {
                "type": "object",
                "properties": {
                    "blend_confidence": {
                        "type": "number"
                    },
                    "blend_markdown": {
                        "type": "string"
                    },
                    "labels": {
                        "$ref": "#/components/schemas/internal_server_endpoints.PageLabels"
                    },
                    "ocr_results": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/internal_server_endpoints.OcrResult"
                        }
                    },
                    "page_num": {
                        "type": "integer"
                    },
                    "status": {
                        "$ref": "#/components/schemas/internal_server_endpoints.PageStatus"
                    }
                }
            },
            "internal_server_endpoints.HealthResponse": {
                "type": "object",
                "properties": {
                    "defra": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.IngestRequest": {
                "type": "object",
                "properties": {
                    "author": {
                        "type": "string"
                    },
                    "pdf_paths": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "title": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.IngestResponse": {
                "type": "object",
                "properties": {
                    "author": {
                        "type": "string"
                    },
                    "job_id": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string"
                    },
                    "title": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.JobStatusResponse": {
                "type": "object",
                "properties": {
                    "blend_complete": {
                        "type": "integer"
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "is_complete": {
                        "type": "boolean"
                    },
                    "job_type": {
                        "type": "string"
                    },
                    "label_complete": {
                        "type": "integer"
                    },
                    "metadata_complete": {
                        "type": "boolean"
                    },
                    "ocr_complete": {
                        "type": "integer"
                    },
                    "toc_extracted": {
                        "type": "boolean"
                    },
                    "toc_found": {
                        "type": "boolean"
                    },
                    "total_pages": {
                        "type": "integer"
                    }
                }
            },
            "internal_server_endpoints.ListBooksResponse": {
                "type": "object",
                "properties": {
                    "books": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/internal_server_endpoints.Book"
                        }
                    }
                }
            },
            "internal_server_endpoints.ListJobsResponse": {
                "type": "object",
                "properties": {
                    "jobs": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.Record"
                        }
                    }
                }
            },
            "internal_server_endpoints.ListMetricsResponse": {
                "type": "object",
                "properties": {
                    "count": {
                        "type": "integer"
                    },
                    "metrics": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_metrics.Metric"
                        }
                    }
                }
            },
            "internal_server_endpoints.ListPagesResponse": {
                "type": "object",
                "properties": {
                    "pages": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/internal_server_endpoints.PageSummary"
                        }
                    },
                    "total_pages": {
                        "type": "integer"
                    }
                }
            },
            "internal_server_endpoints.MetricsCostResponse": {
                "type": "object",
                "properties": {
                    "breakdown": {
                        "type": "object",
                        "additionalProperties": {
                            "type": "number",
                            "format": "float64"
                        }
                    },
                    "total_cost_usd": {
                        "type": "number"
                    }
                }
            },
            "internal_server_endpoints.MetricsSummaryResponse": {
                "type": "object",
                "properties": {
                    "avg_cost_usd": {
                        "type": "number"
                    },
                    "avg_time_seconds": {
                        "type": "number"
                    },
                    "avg_tokens": {
                        "type": "number"
                    },
                    "count": {
                        "type": "integer"
                    },
                    "error_count": {
                        "type": "integer"
                    },
                    "success_count": {
                        "type": "integer"
                    },
                    "total_cost_usd": {
                        "type": "number"
                    },
                    "total_time_seconds": {
                        "type": "number"
                    },
                    "total_tokens": {
                        "type": "integer"
                    }
                }
            },
            "internal_server_endpoints.OcrResult": {
                "type": "object",
                "properties": {
                    "confidence": {
                        "type": "number"
                    },
                    "provider": {
                        "type": "string"
                    },
                    "text": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.PageLabels": {
                "type": "object",
                "properties": {
                    "is_back_matter": {
                        "type": "boolean"
                    },
                    "is_front_matter": {
                        "type": "boolean"
                    },
                    "is_toc_page": {
                        "type": "boolean"
                    },
                    "page_number_label": {
                        "type": "string"
                    },
                    "running_header": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.PageStatus": {
                "type": "object",
                "properties": {
                    "blend_complete": {
                        "type": "boolean"
                    },
                    "extract_complete": {
                        "type": "boolean"
                    },
                    "label_complete": {
                        "type": "boolean"
                    },
                    "ocr_complete": {
                        "type": "boolean"
                    }
                }
            },
            "internal_server_endpoints.PageSummary": {
                "type": "object",
                "properties": {
                    "blend_complete": {
                        "type": "boolean"
                    },
                    "label_complete": {
                        "type": "boolean"
                    },
                    "ocr_complete": {
                        "type": "boolean"
                    },
                    "page_num": {
                        "type": "integer"
                    }
                }
            },
            "internal_server_endpoints.ProvidersStatus": {
                "type": "object",
                "properties": {
                    "llm": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "ocr": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                }
            },
            "internal_server_endpoints.StartJobRequest": {
                "type": "object",
                "properties": {
                    "job_type": {
                        "description": "Optional: defaults to \"process-pages\"",
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.StartJobResponse": {
                "type": "object",
                "properties": {
                    "book_id": {
                        "type": "string"
                    },
                    "job_id": {
                        "type": "string"
                    },
                    "job_type": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.StatusResponse": {
                "type": "object",
                "properties": {
                    "defra": {
                        "$ref": "#/components/schemas/internal_server_endpoints.DefraStatus"
                    },
                    "providers": {
                        "$ref": "#/components/schemas/internal_server_endpoints.ProvidersStatus"
                    },
                    "server": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.UpdateJobRequest": {
                "type": "object",
                "properties": {
                    "error": {
                        "type": "string"
                    },
                    "metadata": {
                        "type": "object",
                        "additionalProperties": {}
                    },
                    "status": {
                        "type": "string"
                    }
                }
            },
            "time.Duration": {
                "type": "integer",
                "format": "int64",
                "enum": [
                    -9223372036854776000,
                    9223372036854776000,
                    1,
                    1000,
                    1000000,
                    1000000000,
                    60000000000,
                    3600000000000
                ],
                "x-enum-varnames": [
                    "minDuration",
                    "maxDuration",
                    "Nanosecond",
                    "Microsecond",
                    "Millisecond",
                    "Second",
                    "Minute",
                    "Hour"
                ]
            }
        }
    }
}