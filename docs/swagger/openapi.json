{
    "openapi": "3.0.0",
    "info": {
        "description": "Book digitization pipeline API for managing books, jobs, and processing.",
        "title": "Shelf API",
        "contact": {
            "name": "API Support",
            "url": "https://github.com/jackzampolin/shelf"
        },
        "license": {
            "name": "MIT",
            "url": "https://opensource.org/licenses/MIT"
        },
        "version": "1.0"
    },
    "paths": {
        "/api/agent-logs/{id}": {
            "get": {
                "description": "Get full agent log including messages and tool calls",
                "tags": [
                    "agent-logs"
                ],
                "summary": "Get agent log details",
                "parameters": [
                    {
                        "description": "Agent Log ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.AgentLogDetailResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books": {
            "get": {
                "description": "List all books in the library",
                "tags": [
                    "books"
                ],
                "summary": "List books",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ListBooksResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/ingest": {
            "post": {
                "description": "Ingest PDF files as a new book and start processing",
                "tags": [
                    "books"
                ],
                "summary": "Ingest book scans",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/internal_server_endpoints.IngestRequest"
                            }
                        }
                    },
                    "description": "Ingest request",
                    "required": true
                },
                "responses": {
                    "202": {
                        "description": "Accepted",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.IngestResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/ingest/upload": {
            "post": {
                "description": "Upload PDF files to ingest as a new book",
                "tags": [
                    "books"
                ],
                "summary": "Upload and ingest book PDFs",
                "requestBody": {
                    "content": {
                        "multipart/form-data": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "files": {
                                        "description": "PDF files to ingest",
                                        "type": "string",
                                        "format": "binary"
                                    },
                                    "title": {
                                        "description": "Book title (derived from filename if not provided)",
                                        "type": "string"
                                    },
                                    "author": {
                                        "description": "Book author",
                                        "type": "string"
                                    }
                                },
                                "required": [
                                    "files"
                                ]
                            }
                        }
                    },
                    "required": true
                },
                "responses": {
                    "202": {
                        "description": "Accepted",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.IngestResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/agent-logs": {
            "get": {
                "description": "Get all agent execution logs for a book",
                "tags": [
                    "agent-logs"
                ],
                "summary": "List agent logs for a book",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.AgentLogsListResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/pages": {
            "get": {
                "description": "List all pages for a book with processing status",
                "tags": [
                    "pages"
                ],
                "summary": "List pages",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ListPagesResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/pages/{page_num}": {
            "get": {
                "description": "Get full details for a specific page including OCR results, blend output, and labels",
                "tags": [
                    "pages"
                ],
                "summary": "Get page details",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Page number (1-indexed)",
                        "name": "page_num",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.GetPageResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/pages/{page_num}/image": {
            "get": {
                "description": "Get the PNG image for a specific page of a book",
                "tags": [
                    "pages"
                ],
                "summary": "Get page image",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Page number (1-indexed)",
                        "name": "page_num",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "image/png": {
                                "schema": {
                                    "type": "string",
                                    "format": "binary"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "image/png": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "image/png": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "image/png": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/rerun-toc": {
            "post": {
                "description": "Reset ToC state and rerun the ToC finder and extractor agents",
                "tags": [
                    "books"
                ],
                "summary": "Rerun ToC finder and extractor",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "202": {
                        "description": "Accepted",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.RerunTocResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "412": {
                        "description": "Not enough pages have blend complete",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{id}": {
            "get": {
                "description": "Get detailed information about a book",
                "tags": [
                    "books"
                ],
                "summary": "Get book by ID",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.Book"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{id}/cost": {
            "get": {
                "description": "Get total cost for processing a specific book",
                "tags": [
                    "books"
                ],
                "summary": "Get book processing cost",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Breakdown by: stage",
                        "name": "by",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.MetricsCostResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{id}/prompts": {
            "get": {
                "description": "Get all prompts resolved for a specific book (with overrides applied)",
                "tags": [
                    "prompts"
                ],
                "summary": "List prompts for a book",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.BookPromptsListResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{id}/prompts/{key}": {
            "get": {
                "description": "Get a specific prompt resolved for a book (with override if exists)",
                "tags": [
                    "prompts"
                ],
                "summary": "Get a prompt for a book",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Prompt key",
                        "name": "key",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.BookPromptResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "put": {
                "description": "Set a custom prompt for a specific book",
                "tags": [
                    "prompts"
                ],
                "summary": "Set a book prompt override",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Prompt key",
                        "name": "key",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/internal_server_endpoints.SetPromptRequest"
                            }
                        }
                    },
                    "description": "Prompt override",
                    "required": true
                },
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.BookPromptResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "delete": {
                "description": "Remove a custom prompt override for a book (reverts to default)",
                "tags": [
                    "prompts"
                ],
                "summary": "Clear a book prompt override",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Prompt key",
                        "name": "key",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.BookPromptResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs": {
            "get": {
                "description": "List all jobs with optional filtering",
                "tags": [
                    "jobs"
                ],
                "summary": "List jobs",
                "parameters": [
                    {
                        "description": "Filter by status",
                        "name": "status",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by job type",
                        "name": "job_type",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ListJobsResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "post": {
                "description": "Create a new job of the specified type",
                "tags": [
                    "jobs"
                ],
                "summary": "Create a job",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/internal_server_endpoints.CreateJobRequest"
                            }
                        }
                    },
                    "description": "Job creation request",
                    "required": true
                },
                "responses": {
                    "201": {
                        "description": "Created",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.CreateJobResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs/start/{book_id}": {
            "post": {
                "description": "Start processing job (OCR, blend, label) for a book",
                "tags": [
                    "jobs"
                ],
                "summary": "Start job for a book",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/internal_server_endpoints.StartJobRequest"
                            }
                        }
                    },
                    "description": "Optional job type"
                },
                "responses": {
                    "202": {
                        "description": "Accepted",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.StartJobResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs/status/{book_id}": {
            "get": {
                "description": "Get processing status for a book's jobs",
                "tags": [
                    "jobs"
                ],
                "summary": "Get job status for a book",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Job type (default: process-book)",
                        "name": "job_type",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.JobStatusResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs/status/{book_id}/detailed": {
            "get": {
                "description": "Get comprehensive processing status including per-provider OCR progress, costs, metadata, and ToC details",
                "tags": [
                    "jobs"
                ],
                "summary": "Get detailed job status for a book",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.DetailedJobStatusResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs/{id}": {
            "get": {
                "description": "Get detailed job information including live status for running jobs",
                "tags": [
                    "jobs"
                ],
                "summary": "Get job by ID",
                "parameters": [
                    {
                        "description": "Job ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.GetJobResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "delete": {
                "description": "Delete a job by ID",
                "tags": [
                    "jobs"
                ],
                "summary": "Delete a job",
                "parameters": [
                    {
                        "description": "Job ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "204": {
                        "description": "No Content"
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "*/*": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "*/*": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "*/*": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "*/*": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "patch": {
                "description": "Update job status or metadata",
                "tags": [
                    "jobs"
                ],
                "summary": "Update a job",
                "parameters": [
                    {
                        "description": "Job ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/internal_server_endpoints.UpdateJobRequest"
                            }
                        }
                    },
                    "description": "Update request",
                    "required": true
                },
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.Record"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/llmcalls": {
            "get": {
                "description": "Get LLM call history with optional filters",
                "tags": [
                    "llmcalls"
                ],
                "summary": "List LLM calls",
                "parameters": [
                    {
                        "description": "Filter by book ID",
                        "name": "book_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by page ID",
                        "name": "page_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by job ID",
                        "name": "job_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by prompt key",
                        "name": "prompt_key",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by provider",
                        "name": "provider",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by model",
                        "name": "model",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by success status (true or false)",
                        "name": "success",
                        "in": "query",
                        "schema": {
                            "type": "boolean"
                        }
                    },
                    {
                        "description": "Max results (default 100)",
                        "name": "limit",
                        "in": "query",
                        "schema": {
                            "type": "integer"
                        }
                    },
                    {
                        "description": "Result offset",
                        "name": "offset",
                        "in": "query",
                        "schema": {
                            "type": "integer"
                        }
                    },
                    {
                        "description": "Filter calls after this RFC3339 timestamp",
                        "name": "after",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter calls before this RFC3339 timestamp",
                        "name": "before",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.LLMCallsResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/llmcalls/counts/{book_id}": {
            "get": {
                "description": "Get count of LLM calls grouped by prompt key for a book",
                "tags": [
                    "llmcalls"
                ],
                "summary": "Get LLM call counts by prompt key",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.LLMCallCountsResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/llmcalls/{id}": {
            "get": {
                "description": "Get a single LLM call by ID",
                "tags": [
                    "llmcalls"
                ],
                "summary": "Get an LLM call",
                "parameters": [
                    {
                        "description": "LLM call ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.LLMCallResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/metrics": {
            "get": {
                "description": "List LLM/OCR call metrics with optional filtering",
                "tags": [
                    "metrics"
                ],
                "summary": "List metrics",
                "parameters": [
                    {
                        "description": "Filter by job ID",
                        "name": "job_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by book ID",
                        "name": "book_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by stage",
                        "name": "stage",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by provider",
                        "name": "provider",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by model",
                        "name": "model",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Maximum results (default 100)",
                        "name": "limit",
                        "in": "query",
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ListMetricsResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/metrics/cost": {
            "get": {
                "description": "Get total cost with optional breakdown by stage/provider/model",
                "tags": [
                    "metrics"
                ],
                "summary": "Get cost breakdown",
                "parameters": [
                    {
                        "description": "Filter by job ID",
                        "name": "job_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by book ID",
                        "name": "book_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by stage",
                        "name": "stage",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by provider",
                        "name": "provider",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by model",
                        "name": "model",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Breakdown by: stage, provider, or model",
                        "name": "by",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.MetricsCostResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/metrics/summary": {
            "get": {
                "description": "Get aggregated metrics summary with counts, costs, and timing",
                "tags": [
                    "metrics"
                ],
                "summary": "Get metrics summary",
                "parameters": [
                    {
                        "description": "Filter by job ID",
                        "name": "job_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by book ID",
                        "name": "book_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by stage",
                        "name": "stage",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by provider",
                        "name": "provider",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by model",
                        "name": "model",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.MetricsSummaryResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/prompts": {
            "get": {
                "description": "Get all registered prompts with their embedded defaults",
                "tags": [
                    "prompts"
                ],
                "summary": "List all prompts",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.PromptsListResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/prompts/{key}": {
            "get": {
                "description": "Get a specific prompt by key",
                "tags": [
                    "prompts"
                ],
                "summary": "Get a prompt",
                "parameters": [
                    {
                        "description": "Prompt key (e.g., stages.blend.system)",
                        "name": "key",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.PromptResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/settings": {
            "get": {
                "description": "Get all configuration settings",
                "tags": [
                    "settings"
                ],
                "summary": "List all settings",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.SettingsResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/settings/reset/{key}": {
            "post": {
                "description": "Reset a configuration setting to its default value",
                "tags": [
                    "settings"
                ],
                "summary": "Reset a setting to default",
                "parameters": [
                    {
                        "description": "Setting key (URL-encoded)",
                        "name": "key",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.SettingResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/settings/{key}": {
            "get": {
                "description": "Get a single configuration setting by key",
                "tags": [
                    "settings"
                ],
                "summary": "Get a setting",
                "parameters": [
                    {
                        "description": "Setting key (URL-encoded)",
                        "name": "key",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.SettingResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "put": {
                "description": "Update a configuration setting",
                "tags": [
                    "settings"
                ],
                "summary": "Update a setting",
                "parameters": [
                    {
                        "description": "Setting key (URL-encoded)",
                        "name": "key",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/internal_server_endpoints.UpdateSettingRequest"
                            }
                        }
                    },
                    "description": "New value",
                    "required": true
                },
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.SettingResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/health": {
            "get": {
                "description": "Basic health check endpoint",
                "tags": [
                    "health"
                ],
                "summary": "Health check",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.HealthResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/ready": {
            "get": {
                "description": "Readiness check including DefraDB status",
                "tags": [
                    "health"
                ],
                "summary": "Readiness check",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.HealthResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.HealthResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/status": {
            "get": {
                "description": "Get detailed server status including providers and DefraDB",
                "tags": [
                    "health"
                ],
                "summary": "Server status",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/internal_server_endpoints.StatusResponse"
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "servers": [
        {
            "url": "//localhost:8080"
        }
    ],
    "components": {
        "schemas": {
            "github_com_jackzampolin_shelf_internal_config.Entry": {
                "type": "object",
                "properties": {
                    "_docID": {
                        "description": "DefraDB document ID",
                        "type": "string"
                    },
                    "description": {
                        "type": "string"
                    },
                    "key": {
                        "type": "string"
                    },
                    "value": {}
                }
            },
            "github_com_jackzampolin_shelf_internal_jobs.ProviderProgress": {
                "type": "object",
                "properties": {
                    "completed": {
                        "description": "Completed during this job execution",
                        "type": "integer"
                    },
                    "completedAtStart": {
                        "description": "Already completed before job started (from DefraDB)",
                        "type": "integer"
                    },
                    "failed": {
                        "description": "Failed during this job execution",
                        "type": "integer"
                    },
                    "queued": {
                        "description": "Currently queued/in-flight",
                        "type": "integer"
                    },
                    "totalExpected": {
                        "description": "Total work units expected for this provider",
                        "type": "integer"
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_jobs.Record": {
                "type": "object",
                "properties": {
                    "_docID": {
                        "type": "string"
                    },
                    "completed_at": {
                        "type": "string"
                    },
                    "created_at": {
                        "type": "string"
                    },
                    "error": {
                        "type": "string"
                    },
                    "job_type": {
                        "type": "string"
                    },
                    "metadata": {
                        "type": "object",
                        "additionalProperties": {}
                    },
                    "started_at": {
                        "type": "string"
                    },
                    "status": {
                        "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.Status"
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_jobs.Status": {
                "type": "string",
                "enum": [
                    "queued",
                    "running",
                    "completed",
                    "failed",
                    "cancelled"
                ],
                "x-enum-varnames": [
                    "StatusQueued",
                    "StatusRunning",
                    "StatusCompleted",
                    "StatusFailed",
                    "StatusCancelled"
                ]
            },
            "github_com_jackzampolin_shelf_internal_jobs.WorkerStatusInfo": {
                "type": "object",
                "properties": {
                    "queue_depth": {
                        "type": "integer"
                    },
                    "rate_limiter": {
                        "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_providers.RateLimiterStatus"
                    },
                    "type": {
                        "type": "string"
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_llmcall.Call": {
                "type": "object",
                "properties": {
                    "book_id": {
                        "description": "Context references",
                        "type": "string"
                    },
                    "error": {
                        "type": "string"
                    },
                    "id": {
                        "description": "Unique identifier",
                        "type": "string"
                    },
                    "input_tokens": {
                        "description": "Token usage",
                        "type": "integer"
                    },
                    "job_id": {
                        "type": "string"
                    },
                    "latency_ms": {
                        "type": "integer"
                    },
                    "model": {
                        "type": "string"
                    },
                    "output_tokens": {
                        "type": "integer"
                    },
                    "page_id": {
                        "type": "string"
                    },
                    "prompt_cid": {
                        "description": "Content-addressed ID linking to the exact prompt version used",
                        "type": "string"
                    },
                    "prompt_key": {
                        "description": "Prompt traceability",
                        "type": "string"
                    },
                    "provider": {
                        "description": "Model info",
                        "type": "string"
                    },
                    "response": {
                        "description": "Response",
                        "type": "string"
                    },
                    "success": {
                        "description": "Status",
                        "type": "boolean"
                    },
                    "temperature": {
                        "type": "number"
                    },
                    "timestamp": {
                        "description": "Timing",
                        "type": "string"
                    },
                    "tool_calls": {
                        "type": "array",
                        "items": {
                            "type": "integer"
                        }
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_metrics.Metric": {
                "type": "object",
                "properties": {
                    "_docID": {
                        "type": "string"
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "completion_tokens": {
                        "type": "integer"
                    },
                    "cost_usd": {
                        "description": "Cost and tokens",
                        "type": "number"
                    },
                    "created_at": {
                        "description": "Metadata",
                        "type": "string"
                    },
                    "error_type": {
                        "type": "string"
                    },
                    "execution_seconds": {
                        "type": "number"
                    },
                    "item_key": {
                        "description": "e.g., \"page_0001\", \"toc_entry_5\"",
                        "type": "string"
                    },
                    "job_id": {
                        "description": "Attribution (for filtering/aggregation)",
                        "type": "string"
                    },
                    "model": {
                        "type": "string"
                    },
                    "output_cid": {
                        "description": "Exact version (CID)",
                        "type": "string"
                    },
                    "output_doc_id": {
                        "description": "Output reference (version-specific)",
                        "type": "string"
                    },
                    "output_type": {
                        "description": "Collection name",
                        "type": "string"
                    },
                    "prompt_tokens": {
                        "type": "integer"
                    },
                    "provider": {
                        "description": "Provider info",
                        "type": "string"
                    },
                    "queue_seconds": {
                        "description": "Timing",
                        "type": "number"
                    },
                    "reasoning_tokens": {
                        "type": "integer"
                    },
                    "stage": {
                        "type": "string"
                    },
                    "success": {
                        "description": "Status",
                        "type": "boolean"
                    },
                    "total_seconds": {
                        "type": "number"
                    },
                    "total_tokens": {
                        "type": "integer"
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_providers.RateLimiterStatus": {
                "type": "object",
                "properties": {
                    "last_429_time": {
                        "type": "string"
                    },
                    "rps": {
                        "type": "number"
                    },
                    "time_until_token": {
                        "$ref": "#/components/schemas/time.Duration"
                    },
                    "tokens_available": {
                        "type": "number"
                    },
                    "total_consumed": {
                        "type": "integer"
                    },
                    "total_waited": {
                        "$ref": "#/components/schemas/time.Duration"
                    },
                    "utilization": {
                        "type": "number"
                    }
                }
            },
            "internal_server_endpoints.AgentLogDetailResponse": {
                "type": "object",
                "properties": {
                    "agent_type": {
                        "type": "string"
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "completed_at": {
                        "type": "string"
                    },
                    "error": {
                        "type": "string"
                    },
                    "id": {
                        "type": "string"
                    },
                    "iterations": {
                        "type": "integer"
                    },
                    "messages": {
                        "description": "Detailed data",
                        "type": "array",
                        "items": {
                            "type": "integer"
                        }
                    },
                    "result": {
                        "type": "array",
                        "items": {
                            "type": "integer"
                        }
                    },
                    "started_at": {
                        "type": "string"
                    },
                    "success": {
                        "type": "boolean"
                    },
                    "tool_calls": {
                        "type": "array",
                        "items": {
                            "type": "integer"
                        }
                    }
                }
            },
            "internal_server_endpoints.AgentLogSummary": {
                "type": "object",
                "properties": {
                    "agent_type": {
                        "type": "string"
                    },
                    "completed_at": {
                        "type": "string"
                    },
                    "error": {
                        "type": "string"
                    },
                    "id": {
                        "type": "string"
                    },
                    "iterations": {
                        "type": "integer"
                    },
                    "started_at": {
                        "type": "string"
                    },
                    "success": {
                        "type": "boolean"
                    }
                }
            },
            "internal_server_endpoints.AgentLogSummaryResponse": {
                "type": "object",
                "properties": {
                    "agent_type": {
                        "type": "string"
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "completed_at": {
                        "type": "string"
                    },
                    "error": {
                        "type": "string"
                    },
                    "id": {
                        "type": "string"
                    },
                    "iterations": {
                        "type": "integer"
                    },
                    "started_at": {
                        "type": "string"
                    },
                    "success": {
                        "type": "boolean"
                    }
                }
            },
            "internal_server_endpoints.AgentLogsListResponse": {
                "type": "object",
                "properties": {
                    "logs": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/internal_server_endpoints.AgentLogSummaryResponse"
                        }
                    }
                }
            },
            "internal_server_endpoints.Book": {
                "type": "object",
                "properties": {
                    "author": {
                        "type": "string"
                    },
                    "created_at": {
                        "type": "string"
                    },
                    "id": {
                        "type": "string"
                    },
                    "page_count": {
                        "type": "integer"
                    },
                    "status": {
                        "type": "string"
                    },
                    "title": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.BookMetadata": {
                "type": "object",
                "properties": {
                    "author": {
                        "type": "string"
                    },
                    "authors": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "description": {
                        "type": "string"
                    },
                    "isbn": {
                        "type": "string"
                    },
                    "language": {
                        "type": "string"
                    },
                    "lccn": {
                        "type": "string"
                    },
                    "publication_year": {
                        "type": "integer"
                    },
                    "publisher": {
                        "type": "string"
                    },
                    "subjects": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "title": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.BookPromptResponse": {
                "type": "object",
                "properties": {
                    "cid": {
                        "type": "string"
                    },
                    "is_override": {
                        "type": "boolean"
                    },
                    "key": {
                        "type": "string"
                    },
                    "text": {
                        "type": "string"
                    },
                    "variables": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                }
            },
            "internal_server_endpoints.BookPromptsListResponse": {
                "type": "object",
                "properties": {
                    "book_id": {
                        "type": "string"
                    },
                    "prompts": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/internal_server_endpoints.BookPromptResponse"
                        }
                    }
                }
            },
            "internal_server_endpoints.CreateJobRequest": {
                "type": "object",
                "properties": {
                    "job_type": {
                        "type": "string"
                    },
                    "metadata": {
                        "type": "object",
                        "additionalProperties": {}
                    }
                }
            },
            "internal_server_endpoints.CreateJobResponse": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.DefraStatus": {
                "type": "object",
                "properties": {
                    "container": {
                        "type": "string"
                    },
                    "health": {
                        "type": "string"
                    },
                    "url": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.DetailedJobStatusResponse": {
                "type": "object",
                "properties": {
                    "agent_logs": {
                        "description": "Agent logs summary",
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/internal_server_endpoints.AgentLogSummary"
                        }
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "metadata": {
                        "description": "Metadata status",
                        "allOf": [
                            {
                                "$ref": "#/components/schemas/internal_server_endpoints.MetadataStatus"
                            }
                        ]
                    },
                    "ocr_progress": {
                        "description": "Per-provider OCR progress",
                        "type": "object",
                        "additionalProperties": {
                            "$ref": "#/components/schemas/internal_server_endpoints.ProviderProgress"
                        }
                    },
                    "stages": {
                        "description": "Stage progress with costs",
                        "allOf": [
                            {
                                "$ref": "#/components/schemas/internal_server_endpoints.StageProgress"
                            }
                        ]
                    },
                    "toc": {
                        "description": "ToC status",
                        "allOf": [
                            {
                                "$ref": "#/components/schemas/internal_server_endpoints.ToCStatus"
                            }
                        ]
                    },
                    "total_pages": {
                        "type": "integer"
                    }
                }
            },
            "internal_server_endpoints.ErrorResponse": {
                "type": "object",
                "properties": {
                    "error": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.GetJobResponse": {
                "type": "object",
                "properties": {
                    "_docID": {
                        "type": "string"
                    },
                    "completed_at": {
                        "type": "string"
                    },
                    "created_at": {
                        "type": "string"
                    },
                    "error": {
                        "type": "string"
                    },
                    "job_type": {
                        "type": "string"
                    },
                    "live_status": {
                        "description": "Live status fields (only populated for running jobs)",
                        "type": "object",
                        "additionalProperties": {
                            "type": "string"
                        }
                    },
                    "metadata": {
                        "type": "object",
                        "additionalProperties": {}
                    },
                    "pending_units": {
                        "type": "integer"
                    },
                    "progress": {
                        "type": "object",
                        "additionalProperties": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.ProviderProgress"
                        }
                    },
                    "started_at": {
                        "type": "string"
                    },
                    "status": {
                        "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.Status"
                    },
                    "worker_status": {
                        "type": "object",
                        "additionalProperties": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.WorkerStatusInfo"
                        }
                    }
                }
            },
            "internal_server_endpoints.GetPageResponse": {
                "type": "object",
                "properties": {
                    "blend_confidence": {
                        "type": "number"
                    },
                    "blend_markdown": {
                        "type": "string"
                    },
                    "labels": {
                        "$ref": "#/components/schemas/internal_server_endpoints.PageLabels"
                    },
                    "ocr_results": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/internal_server_endpoints.OcrResult"
                        }
                    },
                    "page_num": {
                        "type": "integer"
                    },
                    "status": {
                        "$ref": "#/components/schemas/internal_server_endpoints.PageStatus"
                    }
                }
            },
            "internal_server_endpoints.HealthResponse": {
                "type": "object",
                "properties": {
                    "defra": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.IngestRequest": {
                "type": "object",
                "properties": {
                    "author": {
                        "type": "string"
                    },
                    "pdf_paths": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "title": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.IngestResponse": {
                "type": "object",
                "properties": {
                    "author": {
                        "type": "string"
                    },
                    "job_id": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string"
                    },
                    "title": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.JobStatusResponse": {
                "type": "object",
                "properties": {
                    "blend_complete": {
                        "type": "integer"
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "is_complete": {
                        "type": "boolean"
                    },
                    "job_type": {
                        "type": "string"
                    },
                    "label_complete": {
                        "type": "integer"
                    },
                    "metadata_complete": {
                        "type": "boolean"
                    },
                    "ocr_complete": {
                        "type": "integer"
                    },
                    "toc_extracted": {
                        "type": "boolean"
                    },
                    "toc_found": {
                        "type": "boolean"
                    },
                    "total_pages": {
                        "type": "integer"
                    }
                }
            },
            "internal_server_endpoints.LLMCallCountsResponse": {
                "type": "object",
                "properties": {
                    "counts": {
                        "type": "object",
                        "additionalProperties": {
                            "type": "integer"
                        }
                    }
                }
            },
            "internal_server_endpoints.LLMCallResponse": {
                "type": "object",
                "properties": {
                    "call": {
                        "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_llmcall.Call"
                    },
                    "error": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.LLMCallsResponse": {
                "type": "object",
                "properties": {
                    "calls": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_llmcall.Call"
                        }
                    },
                    "total": {
                        "type": "integer"
                    }
                }
            },
            "internal_server_endpoints.ListBooksResponse": {
                "type": "object",
                "properties": {
                    "books": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/internal_server_endpoints.Book"
                        }
                    }
                }
            },
            "internal_server_endpoints.ListJobsResponse": {
                "type": "object",
                "properties": {
                    "jobs": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.Record"
                        }
                    }
                }
            },
            "internal_server_endpoints.ListMetricsResponse": {
                "type": "object",
                "properties": {
                    "count": {
                        "type": "integer"
                    },
                    "metrics": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_metrics.Metric"
                        }
                    }
                }
            },
            "internal_server_endpoints.ListPagesResponse": {
                "type": "object",
                "properties": {
                    "pages": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/internal_server_endpoints.PageSummary"
                        }
                    },
                    "total_pages": {
                        "type": "integer"
                    }
                }
            },
            "internal_server_endpoints.MetadataStatus": {
                "type": "object",
                "properties": {
                    "complete": {
                        "type": "boolean"
                    },
                    "cost_usd": {
                        "type": "number"
                    },
                    "data": {
                        "$ref": "#/components/schemas/internal_server_endpoints.BookMetadata"
                    },
                    "failed": {
                        "type": "boolean"
                    },
                    "started": {
                        "type": "boolean"
                    }
                }
            },
            "internal_server_endpoints.MetricsCostResponse": {
                "type": "object",
                "properties": {
                    "breakdown": {
                        "type": "object",
                        "additionalProperties": {
                            "type": "number",
                            "format": "float64"
                        }
                    },
                    "total_cost_usd": {
                        "type": "number"
                    }
                }
            },
            "internal_server_endpoints.MetricsSummaryResponse": {
                "type": "object",
                "properties": {
                    "avg_cost_usd": {
                        "type": "number"
                    },
                    "avg_time_seconds": {
                        "type": "number"
                    },
                    "avg_tokens": {
                        "type": "number"
                    },
                    "count": {
                        "type": "integer"
                    },
                    "error_count": {
                        "type": "integer"
                    },
                    "success_count": {
                        "type": "integer"
                    },
                    "total_cost_usd": {
                        "type": "number"
                    },
                    "total_time_seconds": {
                        "type": "number"
                    },
                    "total_tokens": {
                        "type": "integer"
                    }
                }
            },
            "internal_server_endpoints.OcrResult": {
                "type": "object",
                "properties": {
                    "confidence": {
                        "type": "number"
                    },
                    "provider": {
                        "type": "string"
                    },
                    "text": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.PageLabels": {
                "type": "object",
                "properties": {
                    "is_back_matter": {
                        "type": "boolean"
                    },
                    "is_front_matter": {
                        "type": "boolean"
                    },
                    "is_toc_page": {
                        "type": "boolean"
                    },
                    "page_number_label": {
                        "type": "string"
                    },
                    "running_header": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.PageStatus": {
                "type": "object",
                "properties": {
                    "blend_complete": {
                        "type": "boolean"
                    },
                    "extract_complete": {
                        "type": "boolean"
                    },
                    "label_complete": {
                        "type": "boolean"
                    },
                    "ocr_complete": {
                        "type": "boolean"
                    }
                }
            },
            "internal_server_endpoints.PageSummary": {
                "type": "object",
                "properties": {
                    "blend_complete": {
                        "type": "boolean"
                    },
                    "label_complete": {
                        "type": "boolean"
                    },
                    "ocr_complete": {
                        "type": "boolean"
                    },
                    "page_num": {
                        "type": "integer"
                    }
                }
            },
            "internal_server_endpoints.PromptResponse": {
                "type": "object",
                "properties": {
                    "description": {
                        "type": "string"
                    },
                    "doc_id": {
                        "type": "string"
                    },
                    "hash": {
                        "type": "string"
                    },
                    "key": {
                        "type": "string"
                    },
                    "text": {
                        "type": "string"
                    },
                    "variables": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                }
            },
            "internal_server_endpoints.PromptsListResponse": {
                "type": "object",
                "properties": {
                    "prompts": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/internal_server_endpoints.PromptResponse"
                        }
                    }
                }
            },
            "internal_server_endpoints.ProviderProgress": {
                "type": "object",
                "properties": {
                    "complete": {
                        "type": "integer"
                    },
                    "cost_usd": {
                        "type": "number"
                    },
                    "total": {
                        "type": "integer"
                    }
                }
            },
            "internal_server_endpoints.ProvidersStatus": {
                "type": "object",
                "properties": {
                    "llm": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "ocr": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                }
            },
            "internal_server_endpoints.RerunTocResponse": {
                "type": "object",
                "properties": {
                    "job_id": {
                        "type": "string"
                    },
                    "message": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.SetPromptRequest": {
                "type": "object",
                "properties": {
                    "note": {
                        "type": "string"
                    },
                    "text": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.SettingResponse": {
                "type": "object",
                "properties": {
                    "entry": {
                        "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_config.Entry"
                    },
                    "error": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.SettingsResponse": {
                "type": "object",
                "properties": {
                    "settings": {
                        "type": "object",
                        "additionalProperties": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_config.Entry"
                        }
                    }
                }
            },
            "internal_server_endpoints.StageProgress": {
                "type": "object",
                "properties": {
                    "blend": {
                        "type": "object",
                        "properties": {
                            "complete": {
                                "type": "integer"
                            },
                            "cost_usd": {
                                "type": "number"
                            },
                            "total": {
                                "type": "integer"
                            }
                        }
                    },
                    "label": {
                        "type": "object",
                        "properties": {
                            "complete": {
                                "type": "integer"
                            },
                            "cost_usd": {
                                "type": "number"
                            },
                            "total": {
                                "type": "integer"
                            }
                        }
                    },
                    "ocr": {
                        "type": "object",
                        "properties": {
                            "complete": {
                                "type": "integer"
                            },
                            "cost_by_provider": {
                                "type": "object",
                                "additionalProperties": {
                                    "type": "number",
                                    "format": "float64"
                                }
                            },
                            "total": {
                                "type": "integer"
                            },
                            "total_cost_usd": {
                                "type": "number"
                            }
                        }
                    }
                }
            },
            "internal_server_endpoints.StartJobRequest": {
                "type": "object",
                "properties": {
                    "job_type": {
                        "description": "Optional: defaults to \"process-book\"",
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.StartJobResponse": {
                "type": "object",
                "properties": {
                    "book_id": {
                        "type": "string"
                    },
                    "job_id": {
                        "type": "string"
                    },
                    "job_type": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.StatusResponse": {
                "type": "object",
                "properties": {
                    "defra": {
                        "$ref": "#/components/schemas/internal_server_endpoints.DefraStatus"
                    },
                    "providers": {
                        "$ref": "#/components/schemas/internal_server_endpoints.ProvidersStatus"
                    },
                    "server": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.ToCEntry": {
                "type": "object",
                "properties": {
                    "actual_page_num": {
                        "type": "integer"
                    },
                    "entry_number": {
                        "type": "string"
                    },
                    "is_linked": {
                        "type": "boolean"
                    },
                    "level": {
                        "type": "integer"
                    },
                    "level_name": {
                        "type": "string"
                    },
                    "printed_page_number": {
                        "type": "string"
                    },
                    "sort_order": {
                        "type": "integer"
                    },
                    "title": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.ToCStatus": {
                "type": "object",
                "properties": {
                    "cost_usd": {
                        "type": "number"
                    },
                    "end_page": {
                        "type": "integer"
                    },
                    "entries": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/internal_server_endpoints.ToCEntry"
                        }
                    },
                    "entries_linked": {
                        "type": "integer"
                    },
                    "entry_count": {
                        "description": "Entries (when extracted)",
                        "type": "integer"
                    },
                    "extract_complete": {
                        "type": "boolean"
                    },
                    "extract_failed": {
                        "type": "boolean"
                    },
                    "extract_started": {
                        "description": "Extract stage",
                        "type": "boolean"
                    },
                    "finder_complete": {
                        "type": "boolean"
                    },
                    "finder_failed": {
                        "type": "boolean"
                    },
                    "finder_started": {
                        "description": "Finder stage",
                        "type": "boolean"
                    },
                    "found": {
                        "type": "boolean"
                    },
                    "link_complete": {
                        "type": "boolean"
                    },
                    "link_failed": {
                        "type": "boolean"
                    },
                    "link_retries": {
                        "type": "integer"
                    },
                    "link_started": {
                        "description": "Link stage",
                        "type": "boolean"
                    },
                    "start_page": {
                        "type": "integer"
                    }
                }
            },
            "internal_server_endpoints.UpdateJobRequest": {
                "type": "object",
                "properties": {
                    "error": {
                        "type": "string"
                    },
                    "metadata": {
                        "type": "object",
                        "additionalProperties": {}
                    },
                    "status": {
                        "type": "string"
                    }
                }
            },
            "internal_server_endpoints.UpdateSettingRequest": {
                "type": "object",
                "properties": {
                    "description": {
                        "type": "string"
                    },
                    "value": {}
                }
            },
            "time.Duration": {
                "type": "integer",
                "format": "int64",
                "enum": [
                    -9223372036854776000,
                    9223372036854776000,
                    1,
                    1000,
                    1000000,
                    1000000000,
                    60000000000,
                    3600000000000
                ],
                "x-enum-varnames": [
                    "minDuration",
                    "maxDuration",
                    "Nanosecond",
                    "Microsecond",
                    "Millisecond",
                    "Second",
                    "Minute",
                    "Hour"
                ]
            }
        }
    }
}