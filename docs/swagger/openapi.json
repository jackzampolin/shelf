{
    "openapi": "3.0.0",
    "info": {
        "description": "Book digitization pipeline API for managing books, jobs, and processing.",
        "title": "Shelf API",
        "contact": {
            "name": "API Support",
            "url": "https://github.com/jackzampolin/shelf"
        },
        "license": {
            "name": "MIT",
            "url": "https://opensource.org/licenses/MIT"
        },
        "version": "1.0"
    },
    "paths": {
        "/api/agent-logs/{id}": {
            "get": {
                "description": "Get full agent log including messages and tool calls",
                "tags": [
                    "agent-logs"
                ],
                "summary": "Get agent log details",
                "parameters": [
                    {
                        "description": "Agent Log ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.AgentLogDetailResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books": {
            "get": {
                "description": "List all books in the library",
                "tags": [
                    "books"
                ],
                "summary": "List books",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ListBooksResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/ingest": {
            "post": {
                "description": "Ingest PDF files as a new book and start processing",
                "tags": [
                    "books"
                ],
                "summary": "Ingest book scans",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/endpoints.IngestRequest"
                            }
                        }
                    },
                    "description": "Ingest request",
                    "required": true
                },
                "responses": {
                    "202": {
                        "description": "Accepted",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.IngestResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/ingest/upload": {
            "post": {
                "description": "Upload PDF files to ingest as a new book",
                "tags": [
                    "books"
                ],
                "summary": "Upload and ingest book PDFs",
                "requestBody": {
                    "content": {
                        "multipart/form-data": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "files": {
                                        "description": "PDF files to ingest",
                                        "type": "string",
                                        "format": "binary"
                                    },
                                    "title": {
                                        "description": "Book title (derived from filename if not provided)",
                                        "type": "string"
                                    },
                                    "author": {
                                        "description": "Book author",
                                        "type": "string"
                                    },
                                    "auto_process": {
                                        "description": "Automatically start processing after ingest",
                                        "type": "boolean"
                                    }
                                },
                                "required": [
                                    "files"
                                ]
                            }
                        }
                    },
                    "required": true
                },
                "responses": {
                    "202": {
                        "description": "Accepted",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.IngestResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/agent-logs": {
            "get": {
                "description": "Get all agent execution logs for a book",
                "tags": [
                    "agent-logs"
                ],
                "summary": "List agent logs for a book",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by stage (toc-pattern, toc-discover, toc-validate, structure-classify, structure-polish)",
                        "name": "stage",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by agent type",
                        "name": "agent_type",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by job ID",
                        "name": "job_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.AgentLogsListResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/audio": {
            "get": {
                "description": "Get TTS audio generation status and available files",
                "tags": [
                    "books",
                    "audio"
                ],
                "summary": "Get audio status",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.AudioStatusResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/audio/{chapter}/download": {
            "get": {
                "description": "Download the generated audio file for a chapter",
                "tags": [
                    "books",
                    "audio"
                ],
                "summary": "Download chapter audio",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Chapter index",
                        "name": "chapter",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "audio/mpeg": {
                                "schema": {
                                    "type": "string",
                                    "format": "binary"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "audio/mpeg": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "audio/mpeg": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/export/epub": {
            "post": {
                "description": "Generate an ePub 3.0 file from a processed book",
                "tags": [
                    "books",
                    "export"
                ],
                "summary": "Export book as ePub",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.EpubExportResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/export/epub/download": {
            "get": {
                "description": "Download the generated ePub file for a book",
                "tags": [
                    "books",
                    "export"
                ],
                "summary": "Download ePub file",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/epub+zip": {
                                "schema": {
                                    "type": "string",
                                    "format": "binary"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/epub+zip": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/epub+zip": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/export/storyteller": {
            "post": {
                "description": "Generate an EPUB 3.0 file with synchronized audio (Media Overlays) for use with Storyteller",
                "tags": [
                    "books",
                    "export",
                    "storyteller"
                ],
                "summary": "Export book as EPUB with Media Overlays for Storyteller",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.StorytellerExportResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/export/storyteller/download": {
            "get": {
                "description": "Download the generated EPUB file with Media Overlays for a book",
                "tags": [
                    "books",
                    "export",
                    "storyteller"
                ],
                "summary": "Download Storyteller EPUB file",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/epub+zip": {
                                "schema": {
                                    "type": "string",
                                    "format": "binary"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/epub+zip": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/epub+zip": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/generate/audio": {
            "post": {
                "description": "Start TTS audiobook generation for a book",
                "tags": [
                    "books",
                    "audio"
                ],
                "summary": "Start TTS audio generation",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/endpoints.GenerateAudioRequest"
                            }
                        }
                    },
                    "description": "TTS options"
                },
                "responses": {
                    "202": {
                        "description": "Accepted",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.GenerateAudioResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/pages": {
            "get": {
                "description": "List all pages for a book with processing status",
                "tags": [
                    "pages"
                ],
                "summary": "List pages",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ListPagesResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/pages/{page_num}": {
            "get": {
                "description": "Get full details for a specific page including OCR results",
                "tags": [
                    "pages"
                ],
                "summary": "Get page details",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Page number (1-indexed)",
                        "name": "page_num",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.GetPageResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/pages/{page_num}/image": {
            "get": {
                "description": "Get the PNG image for a specific page of a book",
                "tags": [
                    "pages"
                ],
                "summary": "Get page image",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Page number (1-indexed)",
                        "name": "page_num",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "image/png": {
                                "schema": {
                                    "type": "string",
                                    "format": "binary"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "image/png": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "image/png": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "image/png": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{book_id}/rerun-toc": {
            "post": {
                "description": "Reset ToC state and rerun the ToC finder and extractor agents",
                "tags": [
                    "books"
                ],
                "summary": "Rerun ToC finder and extractor",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "202": {
                        "description": "Accepted",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.RerunTocResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "412": {
                        "description": "Not enough pages have OCR complete",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{id}": {
            "get": {
                "description": "Get detailed information about a book",
                "tags": [
                    "books"
                ],
                "summary": "Get book by ID",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.Book"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{id}/chapters": {
            "get": {
                "description": "Get chapter structure with page content",
                "tags": [
                    "books"
                ],
                "summary": "Get book chapters",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Include page text content",
                        "name": "include_text",
                        "in": "query",
                        "schema": {
                            "type": "boolean"
                        }
                    },
                    {
                        "description": "Include paragraphs",
                        "name": "include_paragraphs",
                        "in": "query",
                        "schema": {
                            "type": "boolean"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ChaptersResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{id}/cost": {
            "get": {
                "description": "Get total cost for processing a specific book",
                "tags": [
                    "books"
                ],
                "summary": "Get book processing cost",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Breakdown by: stage",
                        "name": "by",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.MetricsCostResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{id}/metrics/detailed": {
            "get": {
                "description": "Get detailed metrics for a specific book including latency percentiles and token breakdowns per stage",
                "tags": [
                    "books",
                    "metrics"
                ],
                "summary": "Get detailed book metrics with percentiles",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.MetricsDetailedResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{id}/prompts": {
            "get": {
                "description": "Get all prompts resolved for a specific book (with overrides applied)",
                "tags": [
                    "prompts"
                ],
                "summary": "List prompts for a book",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.BookPromptsListResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/books/{id}/prompts/{key}": {
            "get": {
                "description": "Get a specific prompt resolved for a book (with override if exists)",
                "tags": [
                    "prompts"
                ],
                "summary": "Get a prompt for a book",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Prompt key",
                        "name": "key",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.BookPromptResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "put": {
                "description": "Set a custom prompt for a specific book",
                "tags": [
                    "prompts"
                ],
                "summary": "Set a book prompt override",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Prompt key",
                        "name": "key",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/endpoints.SetPromptRequest"
                            }
                        }
                    },
                    "description": "Prompt override",
                    "required": true
                },
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.BookPromptResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "delete": {
                "description": "Remove a custom prompt override for a book (reverts to default)",
                "tags": [
                    "prompts"
                ],
                "summary": "Clear a book prompt override",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Prompt key",
                        "name": "key",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.BookPromptResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/health": {
            "get": {
                "description": "Basic health check endpoint",
                "tags": [
                    "health"
                ],
                "summary": "Health check",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.HealthResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs": {
            "get": {
                "description": "List all jobs with optional filtering",
                "tags": [
                    "jobs"
                ],
                "summary": "List jobs",
                "parameters": [
                    {
                        "description": "Filter by status",
                        "name": "status",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by job type",
                        "name": "job_type",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by book ID",
                        "name": "book_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ListJobsResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "post": {
                "description": "Create a new job of the specified type",
                "tags": [
                    "jobs"
                ],
                "summary": "Create a job",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/endpoints.CreateJobRequest"
                            }
                        }
                    },
                    "description": "Job creation request",
                    "required": true
                },
                "responses": {
                    "201": {
                        "description": "Created",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.CreateJobResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs/start/{book_id}": {
            "post": {
                "description": "Start processing job (OCR, blend, label) for a book",
                "tags": [
                    "jobs"
                ],
                "summary": "Start job for a book",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/endpoints.StartJobRequest"
                            }
                        }
                    },
                    "description": "Optional job type"
                },
                "responses": {
                    "202": {
                        "description": "Accepted",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.StartJobResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs/status/{book_id}": {
            "get": {
                "description": "Get processing status for a book's jobs",
                "tags": [
                    "jobs"
                ],
                "summary": "Get job status for a book",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Job type (default: process-book)",
                        "name": "job_type",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.JobStatusResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs/status/{book_id}/detailed": {
            "get": {
                "description": "Get comprehensive processing status including per-provider OCR progress, costs, metadata, and ToC details",
                "tags": [
                    "jobs"
                ],
                "summary": "Get detailed job status for a book",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.DetailedJobStatusResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs/{id}": {
            "get": {
                "description": "Get detailed job information including live status for running jobs",
                "tags": [
                    "jobs"
                ],
                "summary": "Get job by ID",
                "parameters": [
                    {
                        "description": "Job ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.GetJobResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "delete": {
                "description": "Delete a job by ID",
                "tags": [
                    "jobs"
                ],
                "summary": "Delete a job",
                "parameters": [
                    {
                        "description": "Job ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "204": {
                        "description": "No Content"
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "*/*": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "*/*": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "*/*": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "*/*": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "patch": {
                "description": "Update job status or metadata",
                "tags": [
                    "jobs"
                ],
                "summary": "Update a job",
                "parameters": [
                    {
                        "description": "Job ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/endpoints.UpdateJobRequest"
                            }
                        }
                    },
                    "description": "Update request",
                    "required": true
                },
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.Record"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/llmcalls": {
            "get": {
                "description": "Get LLM call history with optional filters",
                "tags": [
                    "llmcalls"
                ],
                "summary": "List LLM calls",
                "parameters": [
                    {
                        "description": "Filter by book ID",
                        "name": "book_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by page ID",
                        "name": "page_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by job ID",
                        "name": "job_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by prompt key",
                        "name": "prompt_key",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by provider",
                        "name": "provider",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by model",
                        "name": "model",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by success status (true or false)",
                        "name": "success",
                        "in": "query",
                        "schema": {
                            "type": "boolean"
                        }
                    },
                    {
                        "description": "Max results (default 100)",
                        "name": "limit",
                        "in": "query",
                        "schema": {
                            "type": "integer"
                        }
                    },
                    {
                        "description": "Result offset",
                        "name": "offset",
                        "in": "query",
                        "schema": {
                            "type": "integer"
                        }
                    },
                    {
                        "description": "Filter calls after this RFC3339 timestamp",
                        "name": "after",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter calls before this RFC3339 timestamp",
                        "name": "before",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.LLMCallsResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/llmcalls/counts/{book_id}": {
            "get": {
                "description": "Get count of LLM calls grouped by prompt key for a book",
                "tags": [
                    "llmcalls"
                ],
                "summary": "Get LLM call counts by prompt key",
                "parameters": [
                    {
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.LLMCallCountsResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/llmcalls/{id}": {
            "get": {
                "description": "Get a single LLM call by ID",
                "tags": [
                    "llmcalls"
                ],
                "summary": "Get an LLM call",
                "parameters": [
                    {
                        "description": "LLM call ID",
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.LLMCallResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/metrics": {
            "get": {
                "description": "List LLM/OCR call metrics with optional filtering",
                "tags": [
                    "metrics"
                ],
                "summary": "List metrics",
                "parameters": [
                    {
                        "description": "Filter by job ID",
                        "name": "job_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by book ID",
                        "name": "book_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by stage",
                        "name": "stage",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by provider",
                        "name": "provider",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by model",
                        "name": "model",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Maximum results (default 100)",
                        "name": "limit",
                        "in": "query",
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ListMetricsResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/metrics/cost": {
            "get": {
                "description": "Get total cost with optional breakdown by stage/provider/model",
                "tags": [
                    "metrics"
                ],
                "summary": "Get cost breakdown",
                "parameters": [
                    {
                        "description": "Filter by job ID",
                        "name": "job_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by book ID",
                        "name": "book_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by stage",
                        "name": "stage",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by provider",
                        "name": "provider",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by model",
                        "name": "model",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Breakdown by: stage, provider, or model",
                        "name": "by",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.MetricsCostResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/metrics/detailed": {
            "get": {
                "description": "Get detailed metrics including latency percentiles (p50, p95, p99) and token breakdowns per stage",
                "tags": [
                    "metrics"
                ],
                "summary": "Get detailed metrics with percentiles",
                "parameters": [
                    {
                        "description": "Filter by book ID",
                        "name": "book_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.MetricsDetailedResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/metrics/summary": {
            "get": {
                "description": "Get aggregated metrics summary with counts, costs, and timing",
                "tags": [
                    "metrics"
                ],
                "summary": "Get metrics summary",
                "parameters": [
                    {
                        "description": "Filter by job ID",
                        "name": "job_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by book ID",
                        "name": "book_id",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by stage",
                        "name": "stage",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by provider",
                        "name": "provider",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "description": "Filter by model",
                        "name": "model",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.MetricsSummaryResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/prompts": {
            "get": {
                "description": "Get all registered prompts with their embedded defaults",
                "tags": [
                    "prompts"
                ],
                "summary": "List all prompts",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.PromptsListResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/prompts/{key}": {
            "get": {
                "description": "Get a specific prompt by key",
                "tags": [
                    "prompts"
                ],
                "summary": "Get a prompt",
                "parameters": [
                    {
                        "description": "Prompt key (e.g., stages.blend.system)",
                        "name": "key",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.PromptResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/ready": {
            "get": {
                "description": "Readiness check including DefraDB status",
                "tags": [
                    "health"
                ],
                "summary": "Readiness check",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.HealthResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.HealthResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/settings": {
            "get": {
                "description": "Get all configuration settings",
                "tags": [
                    "settings"
                ],
                "summary": "List all settings",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.SettingsResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/settings/reset/{key}": {
            "post": {
                "description": "Reset a configuration setting to its default value",
                "tags": [
                    "settings"
                ],
                "summary": "Reset a setting to default",
                "parameters": [
                    {
                        "description": "Setting key (URL-encoded)",
                        "name": "key",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.SettingResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/settings/{key}": {
            "get": {
                "description": "Get a single configuration setting by key",
                "tags": [
                    "settings"
                ],
                "summary": "Get a setting",
                "parameters": [
                    {
                        "description": "Setting key (URL-encoded)",
                        "name": "key",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.SettingResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "put": {
                "description": "Update a configuration setting",
                "tags": [
                    "settings"
                ],
                "summary": "Update a setting",
                "parameters": [
                    {
                        "description": "Setting key (URL-encoded)",
                        "name": "key",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/endpoints.UpdateSettingRequest"
                            }
                        }
                    },
                    "description": "New value",
                    "required": true
                },
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.SettingResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/status": {
            "get": {
                "description": "Get detailed server status including providers and DefraDB",
                "tags": [
                    "health"
                ],
                "summary": "Server status",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.StatusResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/tts/config": {
            "get": {
                "description": "Get available TTS voices, models, and formats",
                "tags": [
                    "tts"
                ],
                "summary": "Get TTS configuration",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.TTSConfigResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/voices": {
            "get": {
                "description": "List all available TTS voices from the database",
                "tags": [
                    "voices"
                ],
                "summary": "List TTS voices",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ListVoicesResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "post": {
                "description": "Add a custom voice to the database",
                "tags": [
                    "voices"
                ],
                "summary": "Create voice",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/endpoints.CreateVoiceRequest"
                            }
                        }
                    },
                    "description": "Voice details",
                    "required": true
                },
                "responses": {
                    "201": {
                        "description": "Created",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.VoiceResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/voices/sync": {
            "post": {
                "description": "Sync voices from TTS provider to database",
                "tags": [
                    "voices"
                ],
                "summary": "Sync TTS voices",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.SyncVoicesResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/voices/{voice_id}": {
            "delete": {
                "description": "Delete a voice from the local database",
                "tags": [
                    "voices"
                ],
                "summary": "Delete voice",
                "parameters": [
                    {
                        "description": "Voice ID",
                        "name": "voice_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "additionalProperties": {
                                        "type": "string"
                                    }
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/voices/{voice_id}/default": {
            "put": {
                "description": "Set a voice as the default TTS voice",
                "tags": [
                    "voices"
                ],
                "summary": "Set default voice",
                "parameters": [
                    {
                        "description": "Voice ID",
                        "name": "voice_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "additionalProperties": {
                                        "type": "string"
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/endpoints.ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "servers": [
        {
            "url": "//localhost:8080"
        }
    ],
    "components": {
        "schemas": {
            "endpoints.AgentLogDetailResponse": {
                "type": "object",
                "properties": {
                    "agent_type": {
                        "type": "string"
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "completed_at": {
                        "type": "string"
                    },
                    "error": {
                        "type": "string"
                    },
                    "id": {
                        "type": "string"
                    },
                    "iterations": {
                        "type": "integer"
                    },
                    "job_id": {
                        "type": "string"
                    },
                    "messages": {
                        "description": "Detailed data",
                        "type": "array",
                        "items": {
                            "type": "integer"
                        }
                    },
                    "result": {
                        "type": "array",
                        "items": {
                            "type": "integer"
                        }
                    },
                    "started_at": {
                        "type": "string"
                    },
                    "success": {
                        "type": "boolean"
                    },
                    "tool_calls": {
                        "type": "array",
                        "items": {
                            "type": "integer"
                        }
                    }
                }
            },
            "endpoints.AgentLogSummary": {
                "type": "object",
                "properties": {
                    "agent_type": {
                        "type": "string"
                    },
                    "completed_at": {
                        "type": "string"
                    },
                    "error": {
                        "type": "string"
                    },
                    "id": {
                        "type": "string"
                    },
                    "iterations": {
                        "type": "integer"
                    },
                    "started_at": {
                        "type": "string"
                    },
                    "success": {
                        "type": "boolean"
                    }
                }
            },
            "endpoints.AgentLogSummaryResponse": {
                "type": "object",
                "properties": {
                    "agent_type": {
                        "type": "string"
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "completed_at": {
                        "type": "string"
                    },
                    "error": {
                        "type": "string"
                    },
                    "id": {
                        "type": "string"
                    },
                    "iterations": {
                        "type": "integer"
                    },
                    "job_id": {
                        "type": "string"
                    },
                    "started_at": {
                        "type": "string"
                    },
                    "success": {
                        "type": "boolean"
                    }
                }
            },
            "endpoints.AgentLogsListResponse": {
                "type": "object",
                "properties": {
                    "logs": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.AgentLogSummaryResponse"
                        }
                    }
                }
            },
            "endpoints.AudioStatusResponse": {
                "type": "object",
                "properties": {
                    "book_id": {
                        "type": "string"
                    },
                    "chapter_count": {
                        "type": "integer"
                    },
                    "chapters": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.ChapterAudioStatus"
                        }
                    },
                    "format": {
                        "type": "string"
                    },
                    "provider": {
                        "type": "string"
                    },
                    "segment_count": {
                        "type": "integer"
                    },
                    "status": {
                        "type": "string"
                    },
                    "total_cost_usd": {
                        "type": "number"
                    },
                    "total_duration_ms": {
                        "type": "integer"
                    },
                    "voice": {
                        "type": "string"
                    }
                }
            },
            "endpoints.Book": {
                "type": "object",
                "properties": {
                    "author": {
                        "type": "string"
                    },
                    "created_at": {
                        "type": "string"
                    },
                    "id": {
                        "type": "string"
                    },
                    "page_count": {
                        "type": "integer"
                    },
                    "page_pattern_analysis_json": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string"
                    },
                    "title": {
                        "type": "string"
                    }
                }
            },
            "endpoints.BookMetadata": {
                "type": "object",
                "properties": {
                    "author": {
                        "type": "string"
                    },
                    "authors": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "description": {
                        "type": "string"
                    },
                    "isbn": {
                        "type": "string"
                    },
                    "language": {
                        "type": "string"
                    },
                    "lccn": {
                        "type": "string"
                    },
                    "publication_year": {
                        "type": "integer"
                    },
                    "publisher": {
                        "type": "string"
                    },
                    "subjects": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "title": {
                        "type": "string"
                    }
                }
            },
            "endpoints.BookPromptResponse": {
                "type": "object",
                "properties": {
                    "cid": {
                        "type": "string"
                    },
                    "is_override": {
                        "type": "boolean"
                    },
                    "key": {
                        "type": "string"
                    },
                    "text": {
                        "type": "string"
                    },
                    "variables": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                }
            },
            "endpoints.BookPromptsListResponse": {
                "type": "object",
                "properties": {
                    "book_id": {
                        "type": "string"
                    },
                    "prompts": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.BookPromptResponse"
                        }
                    }
                }
            },
            "endpoints.ChapterAudioStatus": {
                "type": "object",
                "properties": {
                    "audio_file": {
                        "type": "string"
                    },
                    "chapter_idx": {
                        "type": "integer"
                    },
                    "cost_usd": {
                        "type": "number"
                    },
                    "download_url": {
                        "type": "string"
                    },
                    "duration_ms": {
                        "type": "integer"
                    },
                    "segment_count": {
                        "type": "integer"
                    },
                    "title": {
                        "type": "string"
                    }
                }
            },
            "endpoints.ChapterPage": {
                "type": "object",
                "properties": {
                    "ocr_markdown": {
                        "type": "string"
                    },
                    "page_num": {
                        "type": "integer"
                    }
                }
            },
            "endpoints.ChapterParagraph": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    },
                    "polished_text": {
                        "type": "string"
                    },
                    "raw_text": {
                        "type": "string"
                    },
                    "sort_order": {
                        "type": "integer"
                    },
                    "start_page": {
                        "type": "integer"
                    },
                    "word_count": {
                        "type": "integer"
                    }
                }
            },
            "endpoints.ChapterWithText": {
                "type": "object",
                "properties": {
                    "audio_include": {
                        "type": "boolean"
                    },
                    "audio_include_reasoning": {
                        "type": "string"
                    },
                    "classification_reasoning": {
                        "type": "string"
                    },
                    "content_type": {
                        "type": "string"
                    },
                    "edits_applied_json": {
                        "type": "string"
                    },
                    "end_page": {
                        "type": "integer"
                    },
                    "entry_id": {
                        "type": "string"
                    },
                    "entry_number": {
                        "type": "string"
                    },
                    "id": {
                        "type": "string"
                    },
                    "level": {
                        "type": "integer"
                    },
                    "level_name": {
                        "type": "string"
                    },
                    "matter_type": {
                        "type": "string"
                    },
                    "page_count": {
                        "type": "integer"
                    },
                    "pages": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.ChapterPage"
                        }
                    },
                    "paragraphs": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.ChapterParagraph"
                        }
                    },
                    "polish_complete": {
                        "type": "boolean"
                    },
                    "polish_failed": {
                        "type": "boolean"
                    },
                    "polished_text": {
                        "type": "string"
                    },
                    "sort_order": {
                        "type": "integer"
                    },
                    "start_page": {
                        "type": "integer"
                    },
                    "title": {
                        "type": "string"
                    },
                    "word_count": {
                        "type": "integer"
                    }
                }
            },
            "endpoints.ChaptersResponse": {
                "type": "object",
                "properties": {
                    "book_id": {
                        "type": "string"
                    },
                    "book_title": {
                        "type": "string"
                    },
                    "chapters": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.ChapterWithText"
                        }
                    },
                    "has_chapters": {
                        "type": "boolean"
                    },
                    "total_pages": {
                        "type": "integer"
                    }
                }
            },
            "endpoints.CreateJobRequest": {
                "type": "object",
                "properties": {
                    "job_type": {
                        "type": "string"
                    },
                    "metadata": {
                        "type": "object",
                        "additionalProperties": {}
                    }
                }
            },
            "endpoints.CreateJobResponse": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    }
                }
            },
            "endpoints.CreateVoiceRequest": {
                "type": "object",
                "properties": {
                    "description": {
                        "type": "string"
                    },
                    "name": {
                        "type": "string"
                    },
                    "voice_id": {
                        "type": "string"
                    }
                }
            },
            "endpoints.DefraStatus": {
                "type": "object",
                "properties": {
                    "container": {
                        "type": "string"
                    },
                    "health": {
                        "type": "string"
                    },
                    "url": {
                        "type": "string"
                    }
                }
            },
            "endpoints.DetailedJobStatusResponse": {
                "type": "object",
                "properties": {
                    "agent_logs": {
                        "description": "Agent logs summary",
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.AgentLogSummary"
                        }
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "metadata": {
                        "description": "Metadata status",
                        "allOf": [
                            {
                                "$ref": "#/components/schemas/endpoints.MetadataStatus"
                            }
                        ]
                    },
                    "ocr_progress": {
                        "description": "Per-provider OCR progress",
                        "type": "object",
                        "additionalProperties": {
                            "$ref": "#/components/schemas/endpoints.ProviderProgress"
                        }
                    },
                    "stages": {
                        "description": "Stage progress with costs",
                        "allOf": [
                            {
                                "$ref": "#/components/schemas/endpoints.StageProgress"
                            }
                        ]
                    },
                    "structure": {
                        "description": "Structure status (common-structure job)",
                        "allOf": [
                            {
                                "$ref": "#/components/schemas/endpoints.StructureStatus"
                            }
                        ]
                    },
                    "toc": {
                        "description": "ToC status",
                        "allOf": [
                            {
                                "$ref": "#/components/schemas/endpoints.ToCStatus"
                            }
                        ]
                    },
                    "total_pages": {
                        "type": "integer"
                    }
                }
            },
            "endpoints.DiscoveredPattern": {
                "type": "object",
                "properties": {
                    "heading_format": {
                        "type": "string"
                    },
                    "level": {
                        "type": "integer"
                    },
                    "level_name": {
                        "type": "string"
                    },
                    "pattern_type": {
                        "type": "string"
                    },
                    "range_end": {
                        "type": "string"
                    },
                    "range_start": {
                        "type": "string"
                    },
                    "reasoning": {
                        "type": "string"
                    }
                }
            },
            "endpoints.EpubExportResponse": {
                "type": "object",
                "properties": {
                    "author": {
                        "type": "string"
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "chapter_count": {
                        "type": "integer"
                    },
                    "created_at": {
                        "type": "string"
                    },
                    "download_url": {
                        "type": "string"
                    },
                    "file_path": {
                        "type": "string"
                    },
                    "file_size": {
                        "type": "integer"
                    },
                    "title": {
                        "type": "string"
                    }
                }
            },
            "endpoints.ErrorResponse": {
                "type": "object",
                "properties": {
                    "error": {
                        "type": "string"
                    }
                }
            },
            "endpoints.ExcludedRange": {
                "type": "object",
                "properties": {
                    "end_page": {
                        "type": "integer"
                    },
                    "reason": {
                        "type": "string"
                    },
                    "start_page": {
                        "type": "integer"
                    }
                }
            },
            "endpoints.GenerateAudioRequest": {
                "type": "object",
                "properties": {
                    "format": {
                        "description": "Optional: output format (mp3, wav)",
                        "type": "string"
                    },
                    "voice": {
                        "description": "Optional: voice ID",
                        "type": "string"
                    }
                }
            },
            "endpoints.GenerateAudioResponse": {
                "type": "object",
                "properties": {
                    "book_id": {
                        "type": "string"
                    },
                    "chapters": {
                        "type": "integer"
                    },
                    "job_id": {
                        "type": "string"
                    },
                    "provider": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string"
                    }
                }
            },
            "endpoints.GetJobResponse": {
                "type": "object",
                "properties": {
                    "_docID": {
                        "type": "string"
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "completed_at": {
                        "type": "string"
                    },
                    "created_at": {
                        "type": "string"
                    },
                    "error": {
                        "type": "string"
                    },
                    "job_type": {
                        "type": "string"
                    },
                    "live_status": {
                        "description": "Live status fields (only populated for running jobs)",
                        "type": "object",
                        "additionalProperties": {
                            "type": "string"
                        }
                    },
                    "metadata": {
                        "type": "object",
                        "additionalProperties": {}
                    },
                    "pending_units": {
                        "type": "integer"
                    },
                    "progress": {
                        "type": "object",
                        "additionalProperties": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.ProviderProgress"
                        }
                    },
                    "started_at": {
                        "type": "string"
                    },
                    "status": {
                        "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.Status"
                    },
                    "worker_status": {
                        "type": "object",
                        "additionalProperties": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.WorkerStatusInfo"
                        }
                    }
                }
            },
            "endpoints.GetPageResponse": {
                "type": "object",
                "properties": {
                    "ocr_markdown": {
                        "type": "string"
                    },
                    "ocr_results": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.OcrResult"
                        }
                    },
                    "page_num": {
                        "type": "integer"
                    },
                    "status": {
                        "$ref": "#/components/schemas/endpoints.PageStatus"
                    }
                }
            },
            "endpoints.HealthResponse": {
                "type": "object",
                "properties": {
                    "defra": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string"
                    }
                }
            },
            "endpoints.IngestRequest": {
                "type": "object",
                "properties": {
                    "author": {
                        "type": "string"
                    },
                    "pdf_paths": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "title": {
                        "type": "string"
                    }
                }
            },
            "endpoints.IngestResponse": {
                "type": "object",
                "properties": {
                    "author": {
                        "type": "string"
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "job_id": {
                        "type": "string"
                    },
                    "process_job_id": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string"
                    },
                    "title": {
                        "type": "string"
                    }
                }
            },
            "endpoints.JobStatusResponse": {
                "type": "object",
                "properties": {
                    "book_id": {
                        "type": "string"
                    },
                    "is_complete": {
                        "type": "boolean"
                    },
                    "job_type": {
                        "type": "string"
                    },
                    "metadata_complete": {
                        "type": "boolean"
                    },
                    "ocr_complete": {
                        "type": "integer"
                    },
                    "toc_extracted": {
                        "type": "boolean"
                    },
                    "toc_found": {
                        "type": "boolean"
                    },
                    "total_pages": {
                        "type": "integer"
                    }
                }
            },
            "endpoints.LLMCallCountsResponse": {
                "type": "object",
                "properties": {
                    "counts": {
                        "type": "object",
                        "additionalProperties": {
                            "type": "integer"
                        }
                    }
                }
            },
            "endpoints.LLMCallResponse": {
                "type": "object",
                "properties": {
                    "call": {
                        "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_llmcall.Call"
                    },
                    "error": {
                        "type": "string"
                    }
                }
            },
            "endpoints.LLMCallsResponse": {
                "type": "object",
                "properties": {
                    "calls": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_llmcall.Call"
                        }
                    },
                    "total": {
                        "type": "integer"
                    }
                }
            },
            "endpoints.ListBooksResponse": {
                "type": "object",
                "properties": {
                    "books": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.Book"
                        }
                    }
                }
            },
            "endpoints.ListJobsResponse": {
                "type": "object",
                "properties": {
                    "jobs": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.Record"
                        }
                    }
                }
            },
            "endpoints.ListMetricsResponse": {
                "type": "object",
                "properties": {
                    "count": {
                        "type": "integer"
                    },
                    "metrics": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_metrics.Metric"
                        }
                    }
                }
            },
            "endpoints.ListPagesResponse": {
                "type": "object",
                "properties": {
                    "pages": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.PageSummary"
                        }
                    },
                    "total_pages": {
                        "type": "integer"
                    }
                }
            },
            "endpoints.ListVoicesResponse": {
                "type": "object",
                "properties": {
                    "voices": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.VoiceResponse"
                        }
                    }
                }
            },
            "endpoints.MetadataStatus": {
                "type": "object",
                "properties": {
                    "complete": {
                        "type": "boolean"
                    },
                    "cost_usd": {
                        "type": "number"
                    },
                    "data": {
                        "$ref": "#/components/schemas/endpoints.BookMetadata"
                    },
                    "failed": {
                        "type": "boolean"
                    },
                    "started": {
                        "type": "boolean"
                    }
                }
            },
            "endpoints.MetricsCostResponse": {
                "type": "object",
                "properties": {
                    "breakdown": {
                        "type": "object",
                        "additionalProperties": {
                            "type": "number",
                            "format": "float64"
                        }
                    },
                    "total_cost_usd": {
                        "type": "number"
                    }
                }
            },
            "endpoints.MetricsDetailedResponse": {
                "type": "object",
                "properties": {
                    "book_id": {
                        "type": "string"
                    },
                    "stages": {
                        "type": "object",
                        "additionalProperties": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_metrics.DetailedStats"
                        }
                    }
                }
            },
            "endpoints.MetricsSummaryResponse": {
                "type": "object",
                "properties": {
                    "avg_cost_usd": {
                        "type": "number"
                    },
                    "avg_time_seconds": {
                        "type": "number"
                    },
                    "avg_tokens": {
                        "type": "number"
                    },
                    "count": {
                        "type": "integer"
                    },
                    "error_count": {
                        "type": "integer"
                    },
                    "success_count": {
                        "type": "integer"
                    },
                    "total_cost_usd": {
                        "type": "number"
                    },
                    "total_time_seconds": {
                        "type": "number"
                    },
                    "total_tokens": {
                        "type": "integer"
                    }
                }
            },
            "endpoints.OcrResult": {
                "type": "object",
                "properties": {
                    "confidence": {
                        "type": "number"
                    },
                    "provider": {
                        "type": "string"
                    },
                    "text": {
                        "type": "string"
                    }
                }
            },
            "endpoints.PageStatus": {
                "type": "object",
                "properties": {
                    "extract_complete": {
                        "type": "boolean"
                    },
                    "ocr_complete": {
                        "type": "boolean"
                    }
                }
            },
            "endpoints.PageSummary": {
                "type": "object",
                "properties": {
                    "ocr_complete": {
                        "type": "boolean"
                    },
                    "page_num": {
                        "type": "integer"
                    }
                }
            },
            "endpoints.PatternAnalysisResult": {
                "type": "object",
                "properties": {
                    "excluded_ranges": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.ExcludedRange"
                        }
                    },
                    "patterns": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.DiscoveredPattern"
                        }
                    },
                    "reasoning": {
                        "type": "string"
                    }
                }
            },
            "endpoints.PromptResponse": {
                "type": "object",
                "properties": {
                    "description": {
                        "type": "string"
                    },
                    "doc_id": {
                        "type": "string"
                    },
                    "hash": {
                        "type": "string"
                    },
                    "key": {
                        "type": "string"
                    },
                    "text": {
                        "type": "string"
                    },
                    "variables": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                }
            },
            "endpoints.PromptsListResponse": {
                "type": "object",
                "properties": {
                    "prompts": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.PromptResponse"
                        }
                    }
                }
            },
            "endpoints.ProviderProgress": {
                "type": "object",
                "properties": {
                    "complete": {
                        "type": "integer"
                    },
                    "cost_usd": {
                        "type": "number"
                    },
                    "total": {
                        "type": "integer"
                    }
                }
            },
            "endpoints.ProvidersStatus": {
                "type": "object",
                "properties": {
                    "llm": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "ocr": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                }
            },
            "endpoints.RerunTocResponse": {
                "type": "object",
                "properties": {
                    "job_id": {
                        "type": "string"
                    },
                    "message": {
                        "type": "string"
                    }
                }
            },
            "endpoints.SetPromptRequest": {
                "type": "object",
                "properties": {
                    "note": {
                        "type": "string"
                    },
                    "text": {
                        "type": "string"
                    }
                }
            },
            "endpoints.SettingResponse": {
                "type": "object",
                "properties": {
                    "entry": {
                        "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_config.Entry"
                    },
                    "error": {
                        "type": "string"
                    }
                }
            },
            "endpoints.SettingsResponse": {
                "type": "object",
                "properties": {
                    "settings": {
                        "type": "object",
                        "additionalProperties": {
                            "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_config.Entry"
                        }
                    }
                }
            },
            "endpoints.StageProgress": {
                "type": "object",
                "properties": {
                    "ocr": {
                        "type": "object",
                        "properties": {
                            "complete": {
                                "type": "integer"
                            },
                            "cost_by_provider": {
                                "type": "object",
                                "additionalProperties": {
                                    "type": "number",
                                    "format": "float64"
                                }
                            },
                            "total": {
                                "type": "integer"
                            },
                            "total_cost_usd": {
                                "type": "number"
                            }
                        }
                    },
                    "pattern_analysis": {
                        "type": "object",
                        "properties": {
                            "complete": {
                                "type": "boolean"
                            },
                            "cost_usd": {
                                "type": "number"
                            }
                        }
                    }
                }
            },
            "endpoints.StartJobRequest": {
                "type": "object",
                "properties": {
                    "force": {
                        "description": "Optional: force restart even if already complete",
                        "type": "boolean"
                    },
                    "job_type": {
                        "description": "Optional: defaults to \"process-book\"",
                        "type": "string"
                    },
                    "reset_from": {
                        "description": "Optional: reset this operation and downstream deps before starting",
                        "type": "string"
                    },
                    "variant": {
                        "description": "Optional: pipeline variant (standard, photo-book, text-only, ocr-only)",
                        "type": "string"
                    }
                }
            },
            "endpoints.StartJobResponse": {
                "type": "object",
                "properties": {
                    "book_id": {
                        "type": "string"
                    },
                    "job_id": {
                        "type": "string"
                    },
                    "job_type": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string"
                    }
                }
            },
            "endpoints.StatusResponse": {
                "type": "object",
                "properties": {
                    "defra": {
                        "$ref": "#/components/schemas/endpoints.DefraStatus"
                    },
                    "providers": {
                        "$ref": "#/components/schemas/endpoints.ProvidersStatus"
                    },
                    "server": {
                        "type": "string"
                    }
                }
            },
            "endpoints.StorytellerExportResponse": {
                "type": "object",
                "properties": {
                    "audio_chapters": {
                        "type": "integer"
                    },
                    "author": {
                        "type": "string"
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "chapter_count": {
                        "type": "integer"
                    },
                    "created_at": {
                        "type": "string"
                    },
                    "download_url": {
                        "type": "string"
                    },
                    "file_path": {
                        "type": "string"
                    },
                    "file_size": {
                        "type": "integer"
                    },
                    "title": {
                        "type": "string"
                    },
                    "total_duration_ms": {
                        "type": "integer"
                    }
                }
            },
            "endpoints.StructureStatus": {
                "type": "object",
                "properties": {
                    "chapter_count": {
                        "type": "integer"
                    },
                    "chapters_extracted": {
                        "type": "integer"
                    },
                    "chapters_polished": {
                        "type": "integer"
                    },
                    "chapters_total": {
                        "type": "integer"
                    },
                    "complete": {
                        "type": "boolean"
                    },
                    "cost_usd": {
                        "type": "number"
                    },
                    "failed": {
                        "type": "boolean"
                    },
                    "phase": {
                        "description": "Phase tracking (build -> extract -> classify -> polish -> finalize)",
                        "type": "string"
                    },
                    "polish_failed": {
                        "type": "integer"
                    },
                    "retries": {
                        "type": "integer"
                    },
                    "started": {
                        "type": "boolean"
                    }
                }
            },
            "endpoints.SyncVoicesResponse": {
                "type": "object",
                "properties": {
                    "message": {
                        "type": "string"
                    },
                    "synced": {
                        "type": "integer"
                    }
                }
            },
            "endpoints.TTSConfigResponse": {
                "type": "object",
                "properties": {
                    "default_format": {
                        "type": "string"
                    },
                    "default_voice": {
                        "type": "string"
                    },
                    "formats": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "model": {
                        "type": "string"
                    },
                    "provider": {
                        "type": "string"
                    },
                    "voice_cloning_url": {
                        "type": "string"
                    },
                    "voices": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.TTSVoice"
                        }
                    }
                }
            },
            "endpoints.TTSVoice": {
                "type": "object",
                "properties": {
                    "description": {
                        "type": "string"
                    },
                    "name": {
                        "type": "string"
                    },
                    "voice_id": {
                        "type": "string"
                    }
                }
            },
            "endpoints.ToCEntry": {
                "type": "object",
                "properties": {
                    "actual_page_num": {
                        "type": "integer"
                    },
                    "entry_number": {
                        "type": "string"
                    },
                    "is_linked": {
                        "type": "boolean"
                    },
                    "level": {
                        "type": "integer"
                    },
                    "level_name": {
                        "type": "string"
                    },
                    "printed_page_number": {
                        "type": "string"
                    },
                    "sort_order": {
                        "type": "integer"
                    },
                    "source": {
                        "description": "\"extracted\" or \"discovered\"",
                        "type": "string"
                    },
                    "title": {
                        "type": "string"
                    }
                }
            },
            "endpoints.ToCStatus": {
                "type": "object",
                "properties": {
                    "cost_usd": {
                        "type": "number"
                    },
                    "discover_complete": {
                        "description": "All entries discovered",
                        "type": "boolean"
                    },
                    "end_page": {
                        "type": "integer"
                    },
                    "entries": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/endpoints.ToCEntry"
                        }
                    },
                    "entries_discovered": {
                        "description": "Actually discovered (source=\"discovered\")",
                        "type": "integer"
                    },
                    "entries_linked": {
                        "type": "integer"
                    },
                    "entries_to_find": {
                        "description": "From pattern analysis (how many should be discovered)",
                        "type": "integer"
                    },
                    "entry_count": {
                        "description": "Entries (when extracted)",
                        "type": "integer"
                    },
                    "excluded_ranges": {
                        "description": "Number of excluded page ranges",
                        "type": "integer"
                    },
                    "extract_complete": {
                        "type": "boolean"
                    },
                    "extract_failed": {
                        "type": "boolean"
                    },
                    "extract_started": {
                        "description": "Extract stage",
                        "type": "boolean"
                    },
                    "finalize_complete": {
                        "type": "boolean"
                    },
                    "finalize_failed": {
                        "type": "boolean"
                    },
                    "finalize_retries": {
                        "type": "integer"
                    },
                    "finalize_started": {
                        "description": "Finalize stage (overall)",
                        "type": "boolean"
                    },
                    "finder_complete": {
                        "type": "boolean"
                    },
                    "finder_failed": {
                        "type": "boolean"
                    },
                    "finder_started": {
                        "description": "Finder stage",
                        "type": "boolean"
                    },
                    "found": {
                        "type": "boolean"
                    },
                    "link_complete": {
                        "type": "boolean"
                    },
                    "link_failed": {
                        "type": "boolean"
                    },
                    "link_retries": {
                        "type": "integer"
                    },
                    "link_started": {
                        "description": "Link stage",
                        "type": "boolean"
                    },
                    "pattern_analysis": {
                        "description": "Full pattern analysis result",
                        "allOf": [
                            {
                                "$ref": "#/components/schemas/endpoints.PatternAnalysisResult"
                            }
                        ]
                    },
                    "pattern_complete": {
                        "description": "Finalize sub-phases: Pattern Analysis  Chapter Discovery  Gap Validation",
                        "type": "boolean"
                    },
                    "patterns_found": {
                        "description": "Number of patterns discovered",
                        "type": "integer"
                    },
                    "start_page": {
                        "type": "integer"
                    },
                    "validate_complete": {
                        "description": "Gap validation done (same as FinalizeComplete for now)",
                        "type": "boolean"
                    }
                }
            },
            "endpoints.UpdateJobRequest": {
                "type": "object",
                "properties": {
                    "error": {
                        "type": "string"
                    },
                    "metadata": {
                        "type": "object",
                        "additionalProperties": {}
                    },
                    "status": {
                        "type": "string"
                    }
                }
            },
            "endpoints.UpdateSettingRequest": {
                "type": "object",
                "properties": {
                    "description": {
                        "type": "string"
                    },
                    "value": {}
                }
            },
            "endpoints.VoiceResponse": {
                "type": "object",
                "properties": {
                    "created_at": {
                        "type": "string"
                    },
                    "description": {
                        "type": "string"
                    },
                    "is_default": {
                        "type": "boolean"
                    },
                    "name": {
                        "type": "string"
                    },
                    "provider": {
                        "type": "string"
                    },
                    "synced_at": {
                        "type": "string"
                    },
                    "voice_id": {
                        "type": "string"
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_config.Entry": {
                "type": "object",
                "properties": {
                    "_docID": {
                        "description": "DefraDB document ID",
                        "type": "string"
                    },
                    "description": {
                        "type": "string"
                    },
                    "key": {
                        "type": "string"
                    },
                    "value": {}
                }
            },
            "github_com_jackzampolin_shelf_internal_jobs.ProviderProgress": {
                "type": "object",
                "properties": {
                    "completed": {
                        "description": "Completed during this job execution",
                        "type": "integer"
                    },
                    "completedAtStart": {
                        "description": "Already completed before job started (from DefraDB)",
                        "type": "integer"
                    },
                    "failed": {
                        "description": "Failed during this job execution",
                        "type": "integer"
                    },
                    "queued": {
                        "description": "Currently queued/in-flight",
                        "type": "integer"
                    },
                    "totalExpected": {
                        "description": "Total work units expected for this provider",
                        "type": "integer"
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_jobs.RateLimiterStatus": {
                "type": "object",
                "properties": {
                    "last_429_time": {
                        "type": "string"
                    },
                    "rps": {
                        "type": "number"
                    },
                    "time_until_token": {
                        "$ref": "#/components/schemas/time.Duration"
                    },
                    "tokens_available": {
                        "type": "number"
                    },
                    "total_consumed": {
                        "type": "integer"
                    },
                    "total_waited": {
                        "$ref": "#/components/schemas/time.Duration"
                    },
                    "utilization": {
                        "type": "number"
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_jobs.Record": {
                "type": "object",
                "properties": {
                    "_docID": {
                        "type": "string"
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "completed_at": {
                        "type": "string"
                    },
                    "created_at": {
                        "type": "string"
                    },
                    "error": {
                        "type": "string"
                    },
                    "job_type": {
                        "type": "string"
                    },
                    "metadata": {
                        "type": "object",
                        "additionalProperties": {}
                    },
                    "started_at": {
                        "type": "string"
                    },
                    "status": {
                        "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.Status"
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_jobs.Status": {
                "type": "string",
                "enum": [
                    "queued",
                    "running",
                    "completed",
                    "failed",
                    "cancelled"
                ],
                "x-enum-varnames": [
                    "StatusQueued",
                    "StatusRunning",
                    "StatusCompleted",
                    "StatusFailed",
                    "StatusCancelled"
                ]
            },
            "github_com_jackzampolin_shelf_internal_jobs.WorkerStatusInfo": {
                "type": "object",
                "properties": {
                    "queue_depth": {
                        "type": "integer"
                    },
                    "rate_limiter": {
                        "$ref": "#/components/schemas/github_com_jackzampolin_shelf_internal_jobs.RateLimiterStatus"
                    },
                    "type": {
                        "type": "string"
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_llmcall.Call": {
                "type": "object",
                "properties": {
                    "book_id": {
                        "description": "Context references",
                        "type": "string"
                    },
                    "error": {
                        "type": "string"
                    },
                    "id": {
                        "description": "Unique identifier",
                        "type": "string"
                    },
                    "input_tokens": {
                        "description": "Token usage",
                        "type": "integer"
                    },
                    "job_id": {
                        "type": "string"
                    },
                    "latency_ms": {
                        "type": "integer"
                    },
                    "model": {
                        "type": "string"
                    },
                    "output_tokens": {
                        "type": "integer"
                    },
                    "page_id": {
                        "type": "string"
                    },
                    "prompt_cid": {
                        "description": "Content-addressed ID linking to the exact prompt version used",
                        "type": "string"
                    },
                    "prompt_key": {
                        "description": "Prompt traceability",
                        "type": "string"
                    },
                    "provider": {
                        "description": "Model info",
                        "type": "string"
                    },
                    "response": {
                        "description": "Response",
                        "type": "string"
                    },
                    "success": {
                        "description": "Status",
                        "type": "boolean"
                    },
                    "temperature": {
                        "type": "number"
                    },
                    "timestamp": {
                        "description": "Timing",
                        "type": "string"
                    },
                    "tool_calls": {
                        "type": "array",
                        "items": {
                            "type": "integer"
                        }
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_metrics.DetailedStats": {
                "type": "object",
                "properties": {
                    "avg_completion_tokens": {
                        "type": "number"
                    },
                    "avg_cost_usd": {
                        "type": "number"
                    },
                    "avg_prompt_tokens": {
                        "description": "Average tokens per call",
                        "type": "number"
                    },
                    "avg_reasoning_tokens": {
                        "type": "number"
                    },
                    "avg_total_tokens": {
                        "type": "number"
                    },
                    "count": {
                        "description": "Basic counts",
                        "type": "integer"
                    },
                    "error_count": {
                        "type": "integer"
                    },
                    "latency_avg": {
                        "type": "number"
                    },
                    "latency_max": {
                        "type": "number"
                    },
                    "latency_min": {
                        "type": "number"
                    },
                    "latency_p50": {
                        "description": "Latency percentiles (seconds)",
                        "type": "number"
                    },
                    "latency_p95": {
                        "type": "number"
                    },
                    "latency_p99": {
                        "type": "number"
                    },
                    "success_count": {
                        "type": "integer"
                    },
                    "total_completion_tokens": {
                        "type": "integer"
                    },
                    "total_cost_usd": {
                        "description": "Cost",
                        "type": "number"
                    },
                    "total_prompt_tokens": {
                        "description": "Token stats",
                        "type": "integer"
                    },
                    "total_reasoning_tokens": {
                        "type": "integer"
                    },
                    "total_tokens": {
                        "type": "integer"
                    }
                }
            },
            "github_com_jackzampolin_shelf_internal_metrics.Metric": {
                "type": "object",
                "properties": {
                    "_docID": {
                        "type": "string"
                    },
                    "book_id": {
                        "type": "string"
                    },
                    "completion_tokens": {
                        "type": "integer"
                    },
                    "cost_usd": {
                        "description": "Cost and tokens",
                        "type": "number"
                    },
                    "created_at": {
                        "description": "Metadata",
                        "type": "string"
                    },
                    "error_type": {
                        "type": "string"
                    },
                    "execution_seconds": {
                        "type": "number"
                    },
                    "item_key": {
                        "description": "e.g., \"page_0001\", \"toc_entry_5\"",
                        "type": "string"
                    },
                    "job_id": {
                        "description": "Attribution (for filtering/aggregation)",
                        "type": "string"
                    },
                    "model": {
                        "type": "string"
                    },
                    "output_cid": {
                        "description": "Exact version (CID)",
                        "type": "string"
                    },
                    "output_doc_id": {
                        "description": "Output reference (version-specific)",
                        "type": "string"
                    },
                    "output_type": {
                        "description": "Collection name",
                        "type": "string"
                    },
                    "prompt_tokens": {
                        "type": "integer"
                    },
                    "provider": {
                        "description": "Provider info",
                        "type": "string"
                    },
                    "queue_seconds": {
                        "description": "Timing",
                        "type": "number"
                    },
                    "reasoning_tokens": {
                        "type": "integer"
                    },
                    "stage": {
                        "type": "string"
                    },
                    "success": {
                        "description": "Status",
                        "type": "boolean"
                    },
                    "total_seconds": {
                        "type": "number"
                    },
                    "total_tokens": {
                        "type": "integer"
                    }
                }
            },
            "time.Duration": {
                "type": "integer",
                "format": "int64",
                "enum": [
                    -9223372036854776000,
                    9223372036854776000,
                    1,
                    1000,
                    1000000,
                    1000000000,
                    60000000000,
                    3600000000000
                ],
                "x-enum-varnames": [
                    "minDuration",
                    "maxDuration",
                    "Nanosecond",
                    "Microsecond",
                    "Millisecond",
                    "Second",
                    "Minute",
                    "Hour"
                ]
            }
        }
    }
}