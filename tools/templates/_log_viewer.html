<!-- Reusable Log Viewer Component -->
<div class="log-viewer">
    <div class="log-header">
        <h3>ðŸ“‹ Stage Logs</h3>
        <div class="log-controls">
            <select id="level-filter" onchange="window.location.href=updateQueryParam('level', this.value)">
                <option value="">All Levels</option>
                <option value="INFO">INFO</option>
                <option value="ERROR">ERROR</option>
                <option value="WARNING">WARNING</option>
            </select>
            <input type="text"
                   id="search-input"
                   placeholder="Search messages..."
                   value="{{ request.args.get('search', '') }}"
                   onkeyup="if(event.key==='Enter') window.location.href=updateQueryParam('search', this.value)">
        </div>
    </div>

    {% if logs %}
    <div class="log-entries">
        {% for entry in logs %}
        <div class="log-entry log-{{ entry.level|lower }}">
            <div class="log-meta">
                <span class="log-level">{{ entry.level }}</span>
                <span class="log-time">{{ entry.timestamp }}</span>
                {% if entry.page %}
                <span class="log-page">Page {{ entry.page }}</span>
                {% endif %}
                {% if entry.cost_usd %}
                <span class="log-cost">${{ "%.4f"|format(entry.cost_usd) }}</span>
                {% endif %}
                {% if entry.duration_seconds %}
                <span class="log-duration">{{ "%.2f"|format(entry.duration_seconds) }}s</span>
                {% endif %}
            </div>
            <div class="log-message">{{ entry.message }}</div>
            {% if entry.error %}
            <div class="log-error">Error: {{ entry.error }}</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    <div class="log-footer">
        Showing {{ logs|length }} entries from latest log file
    </div>
    {% else %}
    <div class="empty-state">
        <p>No log entries found</p>
    </div>
    {% endif %}
</div>

<style>
    .log-viewer {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .log-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .log-header h3 {
        margin: 0;
    }

    .log-controls {
        display: flex;
        gap: 10px;
    }

    .log-controls select,
    .log-controls input {
        padding: 8px 12px;
        border: 1px solid var(--light);
        border-radius: 4px;
        font-size: 0.9em;
    }

    .log-controls input {
        width: 250px;
    }

    .log-entries {
        max-height: 500px;
        overflow-y: auto;
        border: 1px solid var(--light);
        border-radius: 4px;
    }

    .log-entry {
        padding: 12px;
        border-bottom: 1px solid var(--light);
    }

    .log-entry:last-child {
        border-bottom: none;
    }

    .log-entry.log-error {
        background: #fff5f5;
        border-left: 3px solid #e53e3e;
    }

    .log-entry.log-warning {
        background: #fffaf0;
        border-left: 3px solid #ed8936;
    }

    .log-entry.log-info {
        border-left: 3px solid #3498db;
    }

    .log-meta {
        display: flex;
        gap: 15px;
        margin-bottom: 8px;
        font-size: 0.85em;
        color: var(--text-secondary);
    }

    .log-level {
        font-weight: 600;
        padding: 2px 8px;
        border-radius: 3px;
        background: var(--light);
    }

    .log-entry.log-error .log-level {
        background: #feb2b2;
        color: #742a2a;
    }

    .log-entry.log-warning .log-level {
        background: #fbd38d;
        color: #7c2d12;
    }

    .log-message {
        font-size: 0.95em;
        color: var(--dark);
        line-height: 1.5;
    }

    .log-error {
        margin-top: 8px;
        padding: 8px;
        background: #fed7d7;
        border-radius: 4px;
        font-size: 0.9em;
        color: #742a2a;
    }

    .log-footer {
        margin-top: 10px;
        font-size: 0.85em;
        color: var(--text-secondary);
        text-align: center;
    }
</style>

<script>
function updateQueryParam(key, value) {
    const url = new URL(window.location);
    if (value) {
        url.searchParams.set(key, value);
    } else {
        url.searchParams.delete(key);
    }
    return url.toString();
}
</script>
