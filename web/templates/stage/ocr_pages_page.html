{% extends "base.html" %}

{% block title %}Page {{ page_num }} - OCR Pages - {{ scan_id }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/stage.css') }}">
<style>
.page-view {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 20px;
    height: calc(100vh - 280px);
}

.image-panel {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 15px;
}

.image-panel img {
    max-width: 100%;
    height: auto;
    border: 1px solid #ced4da;
    border-radius: 4px;
}

.text-panel {
    background: #ffffff;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    height: 100%;
}

.tabs {
    display: flex;
    background: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
}

.tab {
    flex: 1;
    padding: 12px 20px;
    text-align: center;
    background: #e9ecef;
    border: none;
    cursor: pointer;
    font-weight: 500;
    color: #495057;
    transition: all 0.2s;
    border-right: 1px solid #dee2e6;
}

.tab:last-child {
    border-right: none;
}

.tab:hover {
    background: #dee2e6;
}

.tab.active {
    background: #ffffff;
    color: #007bff;
    border-bottom: 2px solid #007bff;
    margin-bottom: -2px;
}

.tab-content {
    display: none;
    padding: 20px;
    flex: 1;
    overflow-y: auto;
}

.tab-content.active {
    display: block;
}

.ocr-text {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 14px;
    line-height: 1.6;
    white-space: pre-wrap;
    word-wrap: break-word;
    color: #212529;
}

.no-data {
    color: #6c757d;
    font-style: italic;
    text-align: center;
    padding: 40px;
}

.page-nav {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    align-items: center;
}

.page-nav a {
    padding: 8px 16px;
    background: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-weight: 500;
}

.page-nav a:hover {
    background: #0056b3;
}

.page-nav a.disabled {
    background: #6c757d;
    cursor: not-allowed;
    pointer-events: none;
}

.page-nav .page-info {
    font-size: 1.1em;
    font-weight: 600;
    color: #495057;
}
</style>
{% endblock %}

{% block content %}
<div class="container-wide">
    <div class="stage-header">
        <h2>üìù OCR Pages - Page {{ page_num }}</h2>
        <div class="book-info">
            <a href="/stage/{{ scan_id }}/ocr-pages" style="color: #007bff; text-decoration: none;">
                ‚Üê Back to OCR Pages Overview
            </a>
        </div>
    </div>

    <div class="page-nav">
        {% if page_num > 1 %}
        <a href="/stage/{{ scan_id }}/ocr-pages/page/{{ page_num - 1 }}">‚Üê Previous Page</a>
        {% else %}
        <a class="disabled">‚Üê Previous Page</a>
        {% endif %}

        <span class="page-info">Page {{ page_num }}</span>

        <a href="/stage/{{ scan_id }}/ocr-pages/page/{{ page_num + 1 }}">Next Page ‚Üí</a>
    </div>

    <div class="page-view">
        <!-- Left: Image -->
        <div class="image-panel">
            <h3 style="margin-top: 0;">Source Image</h3>
            <img src="/image/{{ scan_id }}/source/{{ page_num }}" alt="Page {{ page_num }}">
        </div>

        <!-- Right: Tabbed OCR Text -->
        <div class="text-panel">
            <div class="tabs">
                {% for provider in ['olm-ocr', 'mistral-ocr', 'paddle-ocr'] %}
                <button class="tab {% if loop.first %}active{% endif %}" onclick="switchTab('{{ provider }}')">
                    {{ provider }}
                </button>
                {% endfor %}
            </div>

            {% for provider, text in provider_texts.items() %}
            <div id="{{ provider }}" class="tab-content {% if loop.first %}active{% endif %}">
                {% if text %}
                <pre class="ocr-text">{{ text }}</pre>
                {% else %}
                <div class="no-data">No OCR data available for {{ provider }}</div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
function switchTab(providerId) {
    // Hide all tab contents
    const contents = document.querySelectorAll('.tab-content');
    contents.forEach(content => {
        content.classList.remove('active');
    });

    // Remove active class from all tabs
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
        tab.classList.remove('active');
    });

    // Show selected tab content
    const selectedContent = document.getElementById(providerId);
    if (selectedContent) {
        selectedContent.classList.add('active');
    }

    // Add active class to selected tab
    const selectedTab = event.target;
    selectedTab.classList.add('active');
}
</script>
{% endblock %}
