{% extends "base.html" %}

{% block title %}Shelf - Settings{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="settings-header">
        <a href="/" class="back-link">&larr; Library</a>
        <h2>Settings</h2>
        <p class="config-path">{{ config.config_path }}</p>
    </div>

    {% if not config.exists %}
    <div class="empty-state">
        <h3>No configuration found</h3>
        <p>Run <code>shelf init</code> to create a configuration file.</p>
    </div>
    {% else %}
    <div class="settings-sections">
        <!-- API Keys Section -->
        <section class="settings-section" id="api-keys-section">
            <div class="section-header" onclick="toggleSection('api-keys')">
                <h3>API Keys</h3>
                <span class="section-count">{{ config.api_keys|length }} keys</span>
                <span class="toggle-icon" id="api-keys-icon">+</span>
            </div>
            <div class="section-content" id="api-keys-content" style="display: none;"
                 hx-get="/settings/api/api-keys"
                 hx-trigger="revealed"
                 hx-swap="innerHTML">
                <div class="loading">Loading...</div>
            </div>
        </section>

        <!-- OCR Providers Section -->
        <section class="settings-section" id="ocr-providers-section">
            <div class="section-header" onclick="toggleSection('ocr-providers')">
                <h3>OCR Providers</h3>
                <span class="section-count">{{ config.ocr_providers|length }} providers</span>
                <span class="toggle-icon" id="ocr-providers-icon">+</span>
            </div>
            <div class="section-content" id="ocr-providers-content" style="display: none;"
                 hx-get="/settings/api/ocr-providers"
                 hx-trigger="revealed"
                 hx-swap="innerHTML">
                <div class="loading">Loading...</div>
            </div>
        </section>

        <!-- LLM Providers Section -->
        <section class="settings-section" id="llm-providers-section">
            <div class="section-header" onclick="toggleSection('llm-providers')">
                <h3>LLM Providers</h3>
                <span class="section-count">{{ config.llm_providers|length }} providers</span>
                <span class="toggle-icon" id="llm-providers-icon">+</span>
            </div>
            <div class="section-content" id="llm-providers-content" style="display: none;"
                 hx-get="/settings/api/llm-providers"
                 hx-trigger="revealed"
                 hx-swap="innerHTML">
                <div class="loading">Loading...</div>
            </div>
        </section>

        <!-- Defaults Section -->
        <section class="settings-section" id="defaults-section">
            <div class="section-header" onclick="toggleSection('defaults')">
                <h3>Defaults</h3>
                <span class="section-count">{{ config.defaults.ocr_providers|length }} OCR, {{ config.defaults.llm_provider }}</span>
                <span class="toggle-icon" id="defaults-icon">+</span>
            </div>
            <div class="section-content" id="defaults-content" style="display: none;"
                 hx-get="/settings/api/defaults"
                 hx-trigger="revealed"
                 hx-swap="innerHTML">
                <div class="loading">Loading...</div>
            </div>
        </section>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script>
function toggleSection(sectionId) {
    const content = document.getElementById(sectionId + '-content');
    const icon = document.getElementById(sectionId + '-icon');

    if (content.style.display === 'none') {
        content.style.display = 'block';
        icon.textContent = '-';
        // Trigger HTMX to load content if not already loaded
        if (content.querySelector('.loading')) {
            htmx.trigger(content, 'revealed');
        }
    } else {
        content.style.display = 'none';
        icon.textContent = '+';
    }
}
</script>
{% endblock %}
